================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 一括比較 ===
================================================================================
[INFO] ログファイル: C:\Users\sohta\equity01\data\processed\research\reports\run_all_stop_comparison.log

================================================================================
[STEP 1] eval_stop_regimes.py を実行中...
================================================================================

================================================================================
[実行中] eval_stop_regimes.py実行
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\eval_stop_regimes.py
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP条件に基づく戦略評価 ===
================================================================================

[STEP 1] Loading data...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]
[INFO] [OK] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2445 days
  Date range: 2016-01-22 ～ 2025-12-19
  Method: w[t-1] * r_cc[t] (adj_close.pct_change())
  [IMPORTANT] Look-ahead物理遮断: 旧系列（horizon_ensemble_variant_cross4.parquet）は使用しません
[INFO] Aligned returns: 2421 days
  Date range: 2016-01-22 ～ 2025-12-18
[INFO] Loaded inverse returns from data\raw\equities\1569.T.parquet: 2462 days
[INFO] Loaded portfolio holdings from data\processed\daily_portfolio_guarded.parquet: 113724 rows
  Date range: 2016-01-22 ～ 2025-12-19
  Unique dates: 2445
  Unique symbols: 97

================================================================================
=== 日次保有銘柄推移分析 ===
================================================================================

【保有銘柄数の統計】
  平均保有銘柄数: 46.5銘柄
  中央値保有銘柄数: 46.0銘柄
  最小保有銘柄数: 33銘柄
  最大保有銘柄数: 62銘柄
  標準偏差: 4.0銘柄

【銘柄入れ替わり率の統計】
  平均入れ替わり率: 35.44%
  中央値入れ替わり率: 34.09%
  最小入れ替わり率: 4.17%
  最大入れ替わり率: 100.00%
  標準偏差: 12.09%

【入れ替わり率の分布】
  0-5%:    2日 (  0.1%)
  5-10%:    8日 (  0.3%)
  10-20%:  181日 (  7.4%)
  20-30%:  661日 ( 27.0%)
  30-50%: 1290日 ( 52.8%)
  50-100%:  301日 ( 12.3%)

[INFO] Saved daily holdings turnover analysis to data\processed\stop_regime_plots\daily_holdings_turnover.png

【保有銘柄散布図の作成】
[INFO] Saved holdings scatter plot to data\processed\stop_regime_plots\holdings_scatter_by_weight.png
  プロットされた銘柄数: 97銘柄
  プロットされたデータポイント数: 113724点
  ウェイト範囲: 0.000000 ～ 0.179308

【銘柄滞在期間の分析】
  平均滞在期間: 3598.5日
  中央値滞在期間: 3615.0日
  最短滞在期間: 2500日
  最長滞在期間: 3620日

【滞在期間の分布】
  181-365日:   97銘柄 (100.0%)
[INFO] Aligned inverse returns: 2421 days

[STEP 2] Computing STOP conditions...
[INFO] STOP condition (window=60): 318 days (13.1%)
  First STOP day: 2016-02-18 00:00:00
[INFO] STOP condition (window=120): 283 days (11.7%)
  First STOP day: 2016-02-18 00:00:00

[STEP 3] Computing strategy returns...
================================================================================

[CHECK] STOP0 60d:
  STOP期間中の平均リターン: 0.000000 (想定: ~0.0)
  STOP期間外の平均リターン: 0.000552 (想定: cross4と同等)
  STOP期間中のリターン標準偏差: 0.000000
  実効ウェイト範囲: [-0.000, 1.000]
  実効ウェイト平均 (STOP期間中): 0.000000
  実効ウェイト平均 (STOP期間外): 1.000000

[CHECK] Plan A 60d:
  STOP期間中の平均リターン: 0.000168
    想定値 (0.75*port + 0.25*inv): 0.000168
    差分: 0.000000
  STOP期間外の平均リターン: 0.000552
    想定値 (portのみ): 0.000552
    差分: 0.000000
  STOP期間中の実効エクスポージャ合計 (推定): 1.00 (想定: 1.0)
  STOP期間中のリターン誤差平均: 0.000000 (想定: ~0.0)
  STOP期間外の実効エクスポージャ合計 (推定): 1.00 (想定: 1.0)
  STOP期間外のリターン誤差平均: 0.000000 (想定: ~0.0)
  STOP期間中のPlanA vs inverse相関: -0.6087 (想定: 正の相関)
  STOP期間外のPlanA vs inverse相関: -0.7116 (想定: 低い相関)

[CHECK] STOP0 120d:
  STOP期間中の平均リターン: 0.000000 (想定: ~0.0)
  STOP期間外の平均リターン: 0.000401 (想定: cross4と同等)
  STOP期間中のリターン標準偏差: 0.000000
  実効ウェイト範囲: [0.000, 1.000]
  実効ウェイト平均 (STOP期間中): 0.000000
  実効ウェイト平均 (STOP期間外): 1.000000

[CHECK] Plan A 120d:
  STOP期間中の平均リターン: 0.000780
    想定値 (0.75*port + 0.25*inv): 0.000780
    差分: 0.000000
  STOP期間外の平均リターン: 0.000401
    想定値 (portのみ): 0.000401
    差分: 0.000000
  STOP期間中の実効エクスポージャ合計 (推定): 1.00 (想定: 1.0)
  STOP期間中のリターン誤差平均: 0.000000 (想定: ~0.0)
  STOP期間外の実効エクスポージャ合計 (推定): 1.00 (想定: 1.0)
  STOP期間外のリターン誤差平均: 0.000000 (想定: ~0.0)
  STOP期間中のPlanA vs inverse相関: -0.4619 (想定: 正の相関)
  STOP期間外のPlanA vs inverse相関: -0.7234 (想定: 低い相関)

[CHECK 4] Simple STOP benchmark test...
================================================================================
=== Benchmark (TOPIX<0, 60d) ===
  Cumulative: 117.44%
  Annualized:   8.42%
  Alpha Sharpe: -0.17
  MaxDD: -24.97%

Benchmark 60d: Cum=+117.44%, Ann=+8.42%, Sharpe=-0.17, MaxDD=-24.97%
=== Benchmark (TOPIX<0, 120d) ===
  Cumulative:  76.11%
  Annualized:   6.07%
  Alpha Sharpe: -0.31
  MaxDD: -30.35%

Benchmark 120d: Cum=+76.11%, Ann=+6.07%, Sharpe=-0.31, MaxDD=-30.35%

[STEP 4] Evaluating strategies...
================================================================================
=== Baseline cross4 ===
  Cumulative: 220.89%
  Annualized:  12.90%
  Alpha Sharpe:  0.14
  MaxDD: -23.48%

=== STOP0 60d ===
  Cumulative: 181.13%
  Annualized:  11.36%
  Alpha Sharpe:  0.02
  MaxDD: -23.79%

=== STOP0 120d ===
  Cumulative: 106.21%
  Annualized:   7.82%
  Alpha Sharpe: -0.21
  MaxDD: -30.30%

=== Plan A 60d (cross4 75% + inverse 25%) ===
  Cumulative: 194.12%
  Annualized:  11.88%
  Alpha Sharpe:  0.06
  MaxDD: -22.76%

=== Plan A 120d (cross4 75% + inverse 25%) ===
  Cumulative: 155.50%
  Annualized:  10.26%
  Alpha Sharpe: -0.05
  MaxDD: -27.49%

=== Plan B 60d (cash 50%) ===
  Cumulative: 202.22%
  Annualized:  12.20%
  Alpha Sharpe:  0.08
  MaxDD: -23.35%

=== Plan B 120d (cash 50%) ===
  Cumulative: 158.45%
  Annualized:  10.39%
  Alpha Sharpe: -0.04
  MaxDD: -25.65%


[STEP 5] Computing monthly and yearly performance...
================================================================================

Baseline cross4
--------------------------------------------------------------------------------

【Baseline cross4 - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -4.26% +2.16% +0.74% -4.72% -0.37% -3.62% +2.15% -0.50% -2.48% -2.22% -1.80% +4.61% -11.71%
2017  +0.56% -0.41% +0.97% -1.28% +1.83% -0.66% +2.71% -1.92% -0.92% -0.88% +2.50% +1.65%  +4.98%
2018  -0.04% +0.08% -0.94% -0.56% +0.56% +2.86% -1.03% -0.55% +0.35% -0.39% -2.30% +0.40%  -1.30%
2019  +0.81% -1.39% -3.32% +2.65% +0.93% -3.14% +4.86% +2.01% -0.59% +0.48% -1.61% +0.12%  +2.05%
2020  +0.78% +7.60% +5.83% -2.12% -2.15% -4.58% +0.61% -3.88% -0.76% +0.96% -0.29% +3.68%  +7.17%
2021  +2.29% +2.11% -1.26% -0.30% -2.72% +0.69% -2.80% +4.76% -3.12% -3.24% +1.44% -2.55%  -5.50%
2022  +5.08% +0.27% +3.19% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -7.37% +0.17% +3.29% +17.77%
2023  -2.49% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39% -1.07%  +5.11%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% +1.22% +1.61% +0.20% +0.66% -3.75% -2.57% +2.70%  +2.00%
2025  -2.82% +2.04% -0.98% +2.11% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41% +0.34%  +2.37%

【Baseline cross4 - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016       +4.58%     +16.29%    -11.71%
 2017      +25.16%     +20.18%     +4.98%
 2018      -18.58%     -17.27%     -1.30%
 2019      +17.30%     +15.26%     +2.05%
 2020      +12.33%      +5.16%     +7.17%
 2021       +5.08%     +10.59%     -5.50%
 2022      +12.99%      -4.77%    +17.77%
 2023      +30.43%     +25.32%     +5.11%
 2024      +19.97%     +17.96%     +2.00%
 2025      +22.99%     +20.62%     +2.37%

【Baseline cross4 - 年次統計】
年率平均（Port）: +13.2257%
年率平均（TOPIX）: +10.9337%
年率平均（α）: +2.2920%
年率標準偏差（α）: +7.8059%
年率αシャープ: +0.2936
年間勝率: +70.00%

STOP0 60d
--------------------------------------------------------------------------------

【STOP0 60d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov     Dec      年間
year                                                                                              
2016  -4.26% -0.84% +0.74% +0.33% -0.17% +5.27% -5.17% -2.57% -4.53% -2.22% -1.80%  +4.61% -11.24%
2017  +0.56% -0.41% +0.25% -4.67% +1.83% -0.66% +2.71% -1.92% -0.61% -0.88% +2.50%  +1.65%  +0.25%
2018  -0.04% +0.36% -1.85% -4.18% +0.57% +2.86% -1.03% -0.55% -2.41% +3.56% -3.55% +10.86%  +4.70%
2019  -4.78% -6.76% -1.96% +2.65% +2.21% -4.73% +4.10% +2.01% -0.59% +0.48% -1.61%  +0.12%  -9.64%
2020  +0.78% +8.36% +5.83% -2.12% -2.15% -4.58% +0.61% -5.57% -2.39% +0.96% -0.29%  +3.68%  +4.39%
2021  +2.29% +2.11% -1.26% -0.30% -2.98% +4.86% +1.73% -0.59% -4.37% -3.24% +1.44%  -3.88%  -4.64%
2022  +5.08% +0.27% +3.19% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -8.22% -1.49%  +3.29% +14.98%
2023  -0.79% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39%  -3.62%  +3.84%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% -1.27% +1.61% +0.20% +0.66% -1.15% -2.57%  +1.21%  +0.49%
2025  -3.76% +2.04% -0.98% +3.10% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41%  +0.34%  +2.36%

【STOP0 60d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016       +5.05%     +16.29%    -11.24%
 2017      +20.43%     +20.18%     +0.25%
 2018      -12.58%     -17.27%     +4.70%
 2019       +5.61%     +15.26%     -9.64%
 2020       +9.55%      +5.16%     +4.39%
 2021       +5.95%     +10.59%     -4.64%
 2022      +10.21%      -4.77%    +14.98%
 2023      +29.16%     +25.32%     +3.84%
 2024      +18.45%     +17.96%     +0.49%
 2025      +22.98%     +20.62%     +2.36%

【STOP0 60d - 年次統計】
年率平均（Port）: +11.4815%
年率平均（TOPIX）: +10.9337%
年率平均（α）: +0.5478%
年率標準偏差（α）: +7.6330%
年率αシャープ: +0.0718
年間勝率: +70.00%

STOP0 120d
--------------------------------------------------------------------------------

【STOP0 120d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov     Dec      年間
year                                                                                              
2016  -4.26% -0.84% +0.74% -5.13% -0.37% -5.72% +1.16% -4.94% -2.07% -3.67% -4.90%  +4.61% -26.90%
2017  +0.56% -0.41% +0.97% -1.28% +1.83% -0.66% +2.71% -1.92% -0.92% -0.88% +2.50%  +1.65%  +4.98%
2018  -0.04% +0.08% -0.94% -0.56% +0.58% +2.08% -1.03% -2.27% +0.31% -0.39% -4.05% +10.05%  +3.58%
2019  -7.09% -2.53% +0.06% -2.92% +2.81% -2.78% +4.60% +2.01% -0.59% +0.48% -1.61%  +0.12%  -7.91%
2020  +0.78% +7.60% +5.83% -2.12% -2.15% -4.58% +0.61% -3.88% -0.76% +0.96% -0.29%  +3.68%  +7.17%
2021  +2.29% +2.11% -1.26% -0.30% -2.72% +0.69% -2.80% +4.52% -3.12% -3.24% +1.78%  -7.37% -10.41%
2022  +5.08% +0.18% +1.96% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -7.37% +0.17%  +3.29% +16.38%
2023  -3.35% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39%  -1.07%  +4.00%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% +1.22% +1.61% -0.29% -5.20% -9.44% -0.85%  -5.44% -18.50%
2025  -0.07% +2.04% -0.98% -0.58% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41%  +0.34%  +2.52%

【STOP0 120d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      -10.60%     +16.29%    -26.90%
 2017      +25.16%     +20.18%     +4.98%
 2018      -13.69%     -17.27%     +3.58%
 2019       +7.34%     +15.26%     -7.91%
 2020      +12.33%      +5.16%     +7.17%
 2021       +0.18%     +10.59%    -10.41%
 2022      +11.60%      -4.77%    +16.38%
 2023      +29.32%     +25.32%     +4.00%
 2024       -0.53%     +17.96%    -18.50%
 2025      +23.15%     +20.62%     +2.52%

【STOP0 120d - 年次統計】
年率平均（Port）: +8.4250%
年率平均（TOPIX）: +10.9337%
年率平均（α）: -2.5087%
年率標準偏差（α）: +13.1376%
年率αシャープ: -0.1910
年間勝率: +60.00%

Plan A 60d (cross4 75% + inverse 25%)
--------------------------------------------------------------------------------

【Plan A 60d (cross4 75% + inverse 25%) - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -4.26% +0.49% +0.74% -2.86% -0.20% -0.09% -1.67% -1.51% -3.61% -2.22% -1.80% +4.61% -13.36%
2017  +0.56% -0.41% +0.20% -2.91% +1.83% -0.66% +2.71% -1.92% -0.95% -0.88% +2.50% +1.65%  +1.97%
2018  -0.04% +0.69% -1.32% -2.30% +0.56% +2.86% -1.03% -0.55% -1.22% +1.63% -2.97% +6.84%  +3.27%
2019  -1.83% -3.81% -3.03% +2.65% +1.54% -4.47% +4.59% +2.01% -0.59% +0.48% -1.61% +0.12%  -4.34%
2020  +0.78% +8.11% +5.83% -2.12% -2.15% -4.58% +0.61% -4.46% -1.26% +0.96% -0.29% +3.68%  +6.57%
2021  +2.29% +2.11% -1.26% -0.30% -3.14% +1.85% -1.31% +3.01% -3.87% -3.24% +1.44% -3.96%  -7.07%
2022  +5.08% +0.27% +3.19% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -7.73% -0.77% +3.29% +16.33%
2023  -1.91% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39% -2.12%  +4.44%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% -0.21% +1.61% +0.20% +0.66% -2.71% -2.57% +1.94%  +0.72%
2025  -3.43% +2.04% -0.98% +3.13% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41% +0.34%  +2.83%

【Plan A 60d (cross4 75% + inverse 25%) - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016       +2.93%     +16.29%    -13.36%
 2017      +22.15%     +20.18%     +1.97%
 2018      -14.01%     -17.27%     +3.27%
 2019      +10.91%     +15.26%     -4.34%
 2020      +11.73%      +5.16%     +6.57%
 2021       +3.51%     +10.59%     -7.07%
 2022      +11.55%      -4.77%    +16.33%
 2023      +29.76%     +25.32%     +4.44%
 2024      +18.69%     +17.96%     +0.72%
 2025      +23.45%     +20.62%     +2.83%

【Plan A 60d (cross4 75% + inverse 25%) - 年次統計】
年率平均（Port）: +12.0670%
年率平均（TOPIX）: +10.9337%
年率平均（α）: +1.1333%
年率標準偏差（α）: +8.0765%
年率αシャープ: +0.1403
年間勝率: +70.00%

Plan A 120d (cross4 75% + inverse 25%)
--------------------------------------------------------------------------------

【Plan A 120d (cross4 75% + inverse 25%) - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -4.26% +0.49% +0.74% -5.16% -0.37% -5.64% +1.16% -2.33% -2.71% -3.29% -3.96% +4.61% -22.42%
2017  +0.56% -0.41% +0.97% -1.28% +1.83% -0.66% +2.71% -1.92% -0.92% -0.88% +2.50% +1.65%  +4.98%
2018  -0.04% +0.08% -0.94% -0.56% +0.33% +2.30% -1.03% -1.38% +0.85% -0.39% -3.19% +5.47%  +1.51%
2019  -2.58% -2.33% -2.53% +0.82% +2.06% -4.07% +4.87% +2.01% -0.59% +0.48% -1.61% +0.12%  -3.54%
2020  +0.78% +7.60% +5.83% -2.12% -2.15% -4.58% +0.61% -3.88% -0.76% +0.96% -0.29% +3.68%  +7.17%
2021  +2.29% +2.11% -1.26% -0.30% -2.72% +0.69% -2.80% +4.18% -3.12% -3.29% +1.83% -5.08%  -8.35%
2022  +5.08% +0.21% +3.25% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -7.37% +0.17% +3.29% +17.77%
2023  -2.85% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39% -1.07%  +4.64%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% +1.22% +1.61% -0.19% -1.77% -6.41% -2.23% -0.67%  -7.77%
2025  -1.71% +2.04% -0.98% +2.07% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41% +0.34%  +3.72%

【Plan A 120d (cross4 75% + inverse 25%) - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016       -6.13%     +16.29%    -22.42%
 2017      +25.16%     +20.18%     +4.98%
 2018      -15.77%     -17.27%     +1.51%
 2019      +11.72%     +15.26%     -3.54%
 2020      +12.33%      +5.16%     +7.17%
 2021       +2.24%     +10.59%     -8.35%
 2022      +12.99%      -4.77%    +17.77%
 2023      +29.96%     +25.32%     +4.64%
 2024      +10.20%     +17.96%     -7.77%
 2025      +24.35%     +20.62%     +3.72%

【Plan A 120d (cross4 75% + inverse 25%) - 年次統計】
年率平均（Port）: +10.7050%
年率平均（TOPIX）: +10.9337%
年率平均（α）: -0.2287%
年率標準偏差（α）: +10.9241%
年率αシャープ: -0.0209
年間勝率: +60.00%

Plan B 60d (cash 50%)
--------------------------------------------------------------------------------

【Plan B 60d (cash 50%) - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -4.26% +0.65% +0.74% -2.20% -0.26% +0.82% -1.51% -1.47% -3.51% -2.22% -1.80% +4.61% -11.16%
2017  +0.56% -0.41% +0.61% -2.98% +1.83% -0.66% +2.71% -1.92% -0.77% -0.88% +2.50% +1.65%  +2.60%
2018  -0.04% +0.22% -1.39% -2.37% +0.57% +2.86% -1.03% -0.55% -1.03% +1.58% -2.92% +5.53%  +1.71%
2019  -1.99% -4.10% -2.64% +2.65% +1.57% -3.93% +4.48% +2.01% -0.59% +0.48% -1.61% +0.12%  -3.86%
2020  +0.78% +7.98% +5.83% -2.12% -2.15% -4.58% +0.61% -4.72% -1.58% +0.96% -0.29% +3.68%  +5.78%
2021  +2.29% +2.11% -1.26% -0.30% -2.85% +2.78% -0.54% +2.07% -3.75% -3.24% +1.44% -3.19%  -4.97%
2022  +5.08% +0.27% +3.19% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -7.79% -0.66% +3.29% +16.38%
2023  -1.64% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39% -2.35%  +4.48%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% -0.03% +1.61% +0.20% +0.66% -2.44% -2.57% +1.95%  +1.28%
2025  -3.29% +2.04% -0.98% +2.60% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41% +0.34%  +2.37%

【Plan B 60d (cash 50%) - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016       +5.13%     +16.29%    -11.16%
 2017      +22.78%     +20.18%     +2.60%
 2018      -15.56%     -17.27%     +1.71%
 2019      +11.39%     +15.26%     -3.86%
 2020      +10.94%      +5.16%     +5.78%
 2021       +5.62%     +10.59%     -4.97%
 2022      +11.60%      -4.77%    +16.38%
 2023      +29.80%     +25.32%     +4.48%
 2024      +19.24%     +17.96%     +1.28%
 2025      +22.99%     +20.62%     +2.37%

【Plan B 60d (cash 50%) - 年次統計】
年率平均（Port）: +12.3934%
年率平均（TOPIX）: +10.9337%
年率平均（α）: +1.4597%
年率標準偏差（α）: +7.3139%
年率αシャープ: +0.1996
年間勝率: +70.00%

Plan B 120d (cash 50%)
--------------------------------------------------------------------------------

【Plan B 120d (cash 50%) - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -4.26% +0.65% +0.74% -4.92% -0.37% -4.67% +1.71% -2.69% -2.26% -2.95% -3.35% +4.61% -19.45%
2017  +0.56% -0.41% +0.97% -1.28% +1.83% -0.66% +2.71% -1.92% -0.92% -0.88% +2.50% +1.65%  +4.98%
2018  -0.04% +0.08% -0.94% -0.56% +0.57% +2.47% -1.03% -1.40% +0.34% -0.39% -3.18% +5.14%  +1.16%
2019  -3.19% -1.93% -1.61% -0.15% +1.87% -2.95% +4.73% +2.01% -0.59% +0.48% -1.61% +0.12%  -2.89%
2020  +0.78% +7.60% +5.83% -2.12% -2.15% -4.58% +0.61% -3.88% -0.76% +0.96% -0.29% +3.68%  +7.17%
2021  +2.29% +2.11% -1.26% -0.30% -2.72% +0.69% -2.80% +4.64% -3.12% -3.24% +1.61% -4.98%  -7.97%
2022  +5.08% +0.23% +2.57% -0.36% +1.10% +3.41% +1.28% +3.10% +3.78% -7.37% +0.17% +3.29% +17.08%
2023  -2.92% +2.19% -2.15% +0.49% +0.54% +1.26% +0.48% +1.78% +2.91% -1.06% +1.39% -1.07%  +4.55%
2024  -3.29% +7.42% +2.77% -3.42% -1.07% +1.22% +1.61% -0.04% -2.30% -6.62% -1.70% -1.42%  -8.66%
2025  -1.44% +2.04% -0.98% +0.76% -2.72% +7.08% -1.16% -0.16% +0.26% -1.43% -0.41% +0.34%  +2.48%

【Plan B 120d (cash 50%) - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016       -3.16%     +16.29%    -19.45%
 2017      +25.16%     +20.18%     +4.98%
 2018      -16.12%     -17.27%     +1.16%
 2019      +12.37%     +15.26%     -2.89%
 2020      +12.33%      +5.16%     +7.17%
 2021       +2.62%     +10.59%     -7.97%
 2022      +12.31%      -4.77%    +17.08%
 2023      +29.88%     +25.32%     +4.55%
 2024       +9.31%     +17.96%     -8.66%
 2025      +23.10%     +20.62%     +2.48%

【Plan B 120d (cash 50%) - 年次統計】
年率平均（Port）: +10.7782%
年率平均（TOPIX）: +10.9337%
年率平均（α）: -0.1555%
年率標準偏差（α）: +10.1167%
年率αシャープ: -0.0154
年間勝率: +60.00%

[STEP 6] Creating visualizations...
[INFO] Saved strategy comparison to data\processed\stop_regime_plots\strategy_comparison_60d.png

[CHECK 5] Creating STOP timeline plots...
[INFO] Saved STOP timeline to data\processed\stop_regime_plots\stop_timeline_60d.png
[INFO] Saved STOP timeline to data\processed\stop_regime_plots\stop_timeline_120d.png

================================================================================
=== パフォーマンスサマリー ===
================================================================================

                              Strategy Cumulative (%) Annualized (%) Alpha Sharpe MaxDD (%)
                       Baseline cross4        +220.89         +12.90         0.14    -23.48
                             STOP0 60d        +181.13         +11.36         0.02    -23.79
                            STOP0 120d        +106.21          +7.82        -0.21    -30.30
 Plan A 60d (cross4 75% + inverse 25%)        +194.12         +11.88         0.06    -22.76
Plan A 120d (cross4 75% + inverse 25%)        +155.50         +10.26        -0.05    -27.49
                 Plan B 60d (cash 50%)        +202.22         +12.20         0.08    -23.35
                Plan B 120d (cash 50%)        +158.45         +10.39        -0.04    -25.65

[STEP 7] Saving results...
[INFO] Saved strategy returns to data\processed\stop_regime_strategies.parquet

================================================================================
=== 完了 ===
================================================================================


[OK] eval_stop_regimes.py実行 成功

================================================================================
[STEP 2] backtest_from_weights_with_stop.py を各戦略・ウィンドウで実行中...
================================================================================

================================================================================
[実行中] backtest_from_weights_with_stop.py (stop0, w60)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\backtest_from_weights_with_stop.py --strategy stop0 --window 60
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP付cross4 Weights→Returns計算 (STOP0, window=60) ===
================================================================================

[STEP 1] weightsを読み込み中: data\processed\weights\cross4_target_weights_stop0_w60.parquet
  [OK] 236403 rows

[STEP 2] returnsを計算中...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]

[OK] 保存: data\processed\weights_bt\cross4_from_weights_stop0_w60.parquet

================================================================================
【パフォーマンス統計】
================================================================================
=== STOP0 60d ===
  Cumulative: 175.26%
  Annualized:  11.00%
  Alpha Sharpe:  0.05
  MaxDD: -22.42%


【STOP0 60d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -1.20% +3.21% -5.28% +1.02% -0.16% +1.46% +2.31% +1.17% +0.64% -0.97% -0.51% -0.12%  +2.33%
2017  +0.37% +0.49% +0.34% -0.29% -2.59% +0.86% +1.00% -1.23% -4.18% -0.99% -0.89% +0.15%  -8.06%
2018  -0.86% +2.12% -1.70% +0.21% -0.18% -0.38% -1.74% +1.62% -4.59% +5.97% -5.02% +5.89%  +2.18%
2019  +1.10% -0.58% -1.75% +1.07% +2.75% -3.65% +2.53% -0.33% +0.03% -0.47% +0.45% -0.36%  +1.02%
2020  -0.81% +7.18% +3.66% -4.07% -9.08% -1.68% -0.51% +2.87% -2.97% -0.21% -1.67% +1.56%  -5.12%
2021  +3.14% +2.25% -0.66% +1.36% +0.37% +0.05% +0.98% -0.91% -3.48% -0.27% -0.67% -3.78%  -1.70%
2022  +4.26% +1.93% +0.76% +1.69% +0.81% +1.25% +2.00% -0.35% +0.15% -1.32% -0.83% -0.20% +10.32%
2023  -0.89% +0.76% -0.54% +1.48% -1.78% -1.64% +2.77% +2.24% -1.38% -1.19% +2.72% +0.43%  +3.64%
2024  -0.28% -0.79% -0.84% -0.17% -1.11% -1.74% +1.41% +0.62% +0.66% +1.63% -0.65% -0.48%  -1.91%
2025  +0.45% +2.57% -0.19% +0.97% +0.41% +1.40% +1.88% -0.33% -1.66% -1.77% +1.93% +0.33%  +7.50%

【STOP0 60d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      +11.77%      +9.44%     +2.33%
 2017      +14.28%     +22.34%     -8.06%
 2018      -15.59%     -17.77%     +2.18%
 2019      +16.28%     +15.26%     +1.02%
 2020       +0.04%      +5.16%     -5.12%
 2021       +8.89%     +10.59%     -1.70%
 2022       +5.55%      -4.77%    +10.32%
 2023      +28.97%     +25.32%     +3.64%
 2024      +16.06%     +17.96%     -1.91%
 2025      +27.58%     +20.08%     +7.50%

【STOP0 60d - 年次統計】
年率平均（Port）: +11.3821%
年率平均（TOPIX）: +10.3600%
年率平均（α）: +1.0221%
年率標準偏差（α）: +5.5221%
年率αシャープ: +0.1851
年間勝率: +60.00%

================================================================================
完了: STOP付cross4 Weights→Returns計算完了
================================================================================


[OK] backtest_from_weights_with_stop.py (stop0, w60) 成功

================================================================================
[実行中] backtest_from_weights_with_stop.py (stop0, w120)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\backtest_from_weights_with_stop.py --strategy stop0 --window 120
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP付cross4 Weights→Returns計算 (STOP0, window=120) ===
================================================================================

[STEP 1] weightsを読み込み中: data\processed\weights\cross4_target_weights_stop0_w120.parquet
  [OK] 236403 rows

[STEP 2] returnsを計算中...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]

[OK] 保存: data\processed\weights_bt\cross4_from_weights_stop0_w120.parquet

================================================================================
【パフォーマンス統計】
================================================================================
=== STOP0 120d ===
  Cumulative: 189.33%
  Annualized:  11.58%
  Alpha Sharpe:  0.10
  MaxDD: -22.85%


【STOP0 120d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov     Dec      年間
year                                                                                              
2016  -1.20% +3.21% -5.28% +1.02% -0.16% +1.46% +3.70% +1.17% +0.64% -0.97% -0.51%  -0.12%  +3.80%
2017  +0.37% +0.49% +0.34% -0.29% -2.59% +0.86% +1.00% -1.23% -2.00% -0.99% -0.89%  +0.15%  -5.58%
2018  -0.86% +1.84% -0.76% -1.95% -0.18% +1.60% +0.93% +1.19% -4.59% +5.96% -1.54% +16.90% +18.27%
2019  +2.84% -2.65% -1.55% -0.08% -0.71% +1.42% +2.53% -0.33% +0.03% -0.47% +0.45%  -0.36%  +1.01%
2020  -0.81% +1.00% -2.67% -4.07% -6.98% +0.49% +5.51% -6.07% -2.97% -0.21% -1.67%  +1.56% -15.71%
2021  +3.14% +2.25% -0.66% +1.36% +0.37% +0.05% +0.98% -0.91% -0.54% -0.27% -0.67%  -3.74%  +1.51%
2022  +2.69% +1.93% +0.76% +1.69% +0.81% +1.25% +2.00% -0.35% +0.15% -0.26% +0.61%  -0.20% +11.19%
2023  -0.52% +0.76% -1.99% +1.48% -1.78% -1.64% +2.77% +2.24% -1.38% -0.75% +2.72%  +0.43%  +2.84%
2024  -0.28% -0.79% -0.84% -0.17% -1.11% +0.68% +1.41% -8.86% +0.66% +1.63% -0.65%  -0.48% -10.62%
2025  +0.45% +2.57% -0.19% +0.97% +0.41% +1.40% +1.88% -0.33% -1.66% -1.77% +1.93%  +0.33%  +7.50%

【STOP0 120d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      +13.25%      +9.44%     +3.80%
 2017      +16.76%     +22.34%     -5.58%
 2018       +0.50%     -17.77%    +18.27%
 2019      +16.27%     +15.26%     +1.01%
 2020      -10.55%      +5.16%    -15.71%
 2021      +12.10%     +10.59%     +1.51%
 2022       +6.42%      -4.77%    +11.19%
 2023      +28.16%     +25.32%     +2.84%
 2024       +7.34%     +17.96%    -10.62%
 2025      +27.58%     +20.08%     +7.50%

【STOP0 120d - 年次統計】
年率平均（Port）: +11.7810%
年率平均（TOPIX）: +10.3600%
年率平均（α）: +1.4210%
年率標準偏差（α）: +10.0647%
年率αシャープ: +0.1412
年間勝率: +70.00%

================================================================================
完了: STOP付cross4 Weights→Returns計算完了
================================================================================


[OK] backtest_from_weights_with_stop.py (stop0, w120) 成功

================================================================================
[実行中] backtest_from_weights_with_stop.py (planA, w60)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\backtest_from_weights_with_stop.py --strategy planA --window 60
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP付cross4 Weights→Returns計算 (PLANA, window=60) ===
================================================================================

[STEP 1] weightsを読み込み中: data\processed\weights\cross4_target_weights_planA_w60.parquet
  [OK] 236403 rows

[STEP 1.5] インバースETFリターンを読み込み中（Plan A用）...
[INFO] Loaded inverse returns from data\raw\equities\1569.T.parquet: 2462 days
  [OK] 2462 日分

[STEP 1.6] STOP条件を計算中（Plan A用）...
[INFO] STOP condition (window=60): 203 days (8.3%)
  [OK] STOP条件計算完了（window=60）

[STEP 2] returnsを計算中...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]

[OK] 保存: data\processed\weights_bt\cross4_from_weights_planA_w60.parquet

================================================================================
【パフォーマンス統計】
================================================================================
=== Plan A 60d ===
  Cumulative: 224.55%
  Annualized:  12.91%
  Alpha Sharpe:  0.38
  MaxDD: -25.30%


【Plan A 60d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -0.94% +1.63% -1.79% +0.80% -0.18% +0.80% +3.31% +1.15% +0.59% -0.43% +0.29% +0.47%  +6.61%
2017  +0.28% +0.54% +0.04% -0.27% -2.32% +0.96% +1.01% -1.36% -2.77% -0.20% -0.67% +0.19%  -5.36%
2018  -0.72% +1.40% -1.37% +0.67% -0.20% -0.38% -0.09% +1.40% -3.82% +3.01% -3.01% +3.49%  +1.07%
2019  +1.50% -0.55% -1.92% +1.21% +0.03% -0.68% +2.59% -0.68% +0.74% +0.01% +0.72% -0.25%  +2.97%
2020  -0.98% +3.52% -1.00% +0.14% -4.74% -1.61% -0.96% +3.63% -2.95% -0.38% -0.67% +1.91%  -4.19%
2021  +3.11% +2.70% +0.19% +1.16% +0.39% +0.02% +0.83% -0.76% -2.07% -0.64% -0.98% -1.60%  +2.58%
2022  +3.58% +1.92% +1.07% +1.37% +0.76% +1.18% +2.25% -0.25% -0.18% -0.69% +0.18% -0.62% +10.64%
2023  -0.45% +0.83% -1.25% +1.73% -1.33% -0.74% +2.84% +2.31% -1.22% -1.29% +3.12% +0.38%  +6.00%
2024  +0.55% -0.27% -0.55% -0.34% -1.08% -0.54% +1.33% +0.60% +0.41% +1.67% -0.77% -0.25%  +0.92%
2025  +0.42% +2.24% -0.49% +0.50% +0.91% +1.46% +2.13% +0.41% -1.51% -1.48% +2.02% +0.23%  +8.48%

【Plan A 60d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      +16.05%      +9.44%     +6.61%
 2017      +16.98%     +22.34%     -5.36%
 2018      -16.70%     -17.77%     +1.07%
 2019      +18.22%     +15.26%     +2.97%
 2020       +0.97%      +5.16%     -4.19%
 2021      +13.17%     +10.59%     +2.58%
 2022       +5.86%      -4.77%    +10.64%
 2023      +31.32%     +25.32%     +6.00%
 2024      +18.88%     +17.96%     +0.92%
 2025      +28.55%     +20.08%     +8.48%

【Plan A 60d - 年次統計】
年率平均（Port）: +13.3306%
年率平均（TOPIX）: +10.3600%
年率平均（α）: +2.9706%
年率標準偏差（α）: +5.1655%
年率αシャープ: +0.5751
年間勝率: +80.00%

================================================================================
完了: STOP付cross4 Weights→Returns計算完了
================================================================================


[OK] backtest_from_weights_with_stop.py (planA, w60) 成功

================================================================================
[実行中] backtest_from_weights_with_stop.py (planA, w120)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\backtest_from_weights_with_stop.py --strategy planA --window 120
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP付cross4 Weights→Returns計算 (PLANA, window=120) ===
================================================================================

[STEP 1] weightsを読み込み中: data\processed\weights\cross4_target_weights_planA_w120.parquet
  [OK] 236403 rows

[STEP 1.5] インバースETFリターンを読み込み中（Plan A用）...
[INFO] Loaded inverse returns from data\raw\equities\1569.T.parquet: 2462 days
  [OK] 2462 日分

[STEP 1.6] STOP条件を計算中（Plan A用）...
[INFO] STOP condition (window=120): 235 days (9.6%)
  [OK] STOP条件計算完了（window=120）

[STEP 2] returnsを計算中...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]

[OK] 保存: data\processed\weights_bt\cross4_from_weights_planA_w120.parquet

================================================================================
【パフォーマンス統計】
================================================================================
=== Plan A 120d ===
  Cumulative: 224.60%
  Annualized:  12.91%
  Alpha Sharpe:  0.37
  MaxDD: -27.89%


【Plan A 120d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -0.94% +1.63% -1.79% +0.80% -0.18% +0.80% +3.99% +1.15% +0.59% -0.43% +0.29% +0.47%  +7.35%
2017  +0.28% +0.54% +0.04% -0.27% -2.32% +0.96% +1.01% -1.36% -1.59% -0.20% -0.67% +0.19%  -4.00%
2018  -0.72% +1.48% -0.97% -0.33% -0.20% +0.63% +1.06% +1.35% -3.82% +2.94% -1.33% +9.26%  +9.24%
2019  +2.43% -1.52% -1.89% +0.59% -1.47% +1.63% +2.59% -0.68% +0.74% +0.01% +0.72% -0.25%  +2.94%
2020  -0.98% +0.03% -4.70% +0.14% -3.79% -1.00% +1.54% -0.78% -2.95% -0.38% -0.67% +1.91% -11.70%
2021  +3.11% +2.70% +0.19% +1.16% +0.39% +0.02% +0.83% -0.76% -0.18% -0.64% -0.98% -1.79%  +4.45%
2022  +2.57% +1.92% +1.07% +1.37% +0.76% +1.18% +2.25% -0.25% -0.18% -0.07% +0.83% -0.62% +10.84%
2023  -0.37% +0.83% -2.04% +1.73% -1.33% -0.74% +2.84% +2.31% -1.22% -1.02% +3.12% +0.38%  +5.44%
2024  +0.55% -0.27% -0.55% -0.34% -1.08% +0.90% +1.33% -5.29% +0.41% +1.67% -0.77% -0.25%  -4.64%
2025  +0.42% +2.24% -0.49% +0.50% +0.91% +1.46% +2.13% +0.41% -1.51% -1.48% +2.02% +0.23%  +8.48%

【Plan A 120d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      +16.79%      +9.44%     +7.35%
 2017      +18.34%     +22.34%     -4.00%
 2018       -8.53%     -17.77%     +9.24%
 2019      +18.19%     +15.26%     +2.94%
 2020       -6.54%      +5.16%    -11.70%
 2021      +15.04%     +10.59%     +4.45%
 2022       +6.06%      -4.77%    +10.84%
 2023      +30.77%     +25.32%     +5.44%
 2024      +13.32%     +17.96%     -4.64%
 2025      +28.55%     +20.08%     +8.48%

【Plan A 120d - 年次統計】
年率平均（Port）: +13.1997%
年率平均（TOPIX）: +10.3600%
年率平均（α）: +2.8397%
年率標準偏差（α）: +7.3077%
年率αシャープ: +0.3886
年間勝率: +70.00%

================================================================================
完了: STOP付cross4 Weights→Returns計算完了
================================================================================


[OK] backtest_from_weights_with_stop.py (planA, w120) 成功

================================================================================
[実行中] backtest_from_weights_with_stop.py (planB, w60)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\backtest_from_weights_with_stop.py --strategy planB --window 60
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP付cross4 Weights→Returns計算 (PLANB, window=60) ===
================================================================================

[STEP 1] weightsを読み込み中: data\processed\weights\cross4_target_weights_planB_w60.parquet
  [OK] 236403 rows

[STEP 2] returnsを計算中...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]

[OK] 保存: data\processed\weights_bt\cross4_from_weights_planB_w60.parquet

================================================================================
【パフォーマンス統計】
================================================================================
=== Plan B 60d ===
  Cumulative: 199.87%
  Annualized:  11.99%
  Alpha Sharpe:  0.21
  MaxDD: -23.32%


【Plan B 60d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -1.20% +2.22% -1.99% +1.02% -0.16% +1.46% +3.00% +1.17% +0.64% -0.97% -0.51% -0.12%  +5.55%
2017  +0.37% +0.49% +0.34% -0.29% -2.59% +0.86% +1.00% -1.23% -3.09% -0.99% -0.89% +0.15%  -6.82%
2018  -0.86% +1.98% -1.23% +0.21% -0.18% -0.38% -0.41% +1.52% -4.59% +3.89% -3.02% +4.17%  +1.84%
2019  +1.10% -0.58% -1.75% +1.07% +0.57% -1.13% +2.53% -0.33% +0.03% -0.47% +0.45% -0.36%  +1.28%
2020  -0.81% +4.07% +0.14% -0.63% -5.11% -1.68% -0.51% +2.87% -2.97% -0.21% -1.67% +1.56%  -4.69%
2021  +3.14% +2.25% -0.66% +1.36% +0.37% +0.05% +0.98% -0.91% -2.02% -0.27% -0.67% -1.95%  +1.91%
2022  +3.48% +1.93% +0.76% +1.69% +0.81% +1.25% +2.00% -0.35% +0.15% -0.79% -0.11% -0.20% +10.77%
2023  -0.89% +0.76% -1.26% +1.48% -1.78% -1.64% +2.77% +2.24% -1.38% -0.97% +2.72% +0.43%  +3.01%
2024  -0.28% -0.79% -0.84% -0.17% -1.11% -0.54% +1.41% +0.62% +0.66% +1.63% -0.65% -0.48%  -0.49%
2025  +0.45% +2.57% -0.19% +0.97% +0.41% +1.40% +1.88% -0.33% -1.66% -1.77% +1.93% +0.33%  +7.50%

【Plan B 60d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      +15.00%      +9.44%     +5.55%
 2017      +15.52%     +22.34%     -6.82%
 2018      -15.94%     -17.77%     +1.84%
 2019      +16.54%     +15.26%     +1.28%
 2020       +0.47%      +5.16%     -4.69%
 2021      +12.49%     +10.59%     +1.91%
 2022       +5.99%      -4.77%    +10.77%
 2023      +28.34%     +25.32%     +3.01%
 2024      +17.47%     +17.96%     -0.49%
 2025      +27.58%     +20.08%     +7.50%

【Plan B 60d - 年次統計】
年率平均（Port）: +12.3466%
年率平均（TOPIX）: +10.3600%
年率平均（α）: +1.9866%
年率標準偏差（α）: +5.2716%
年率αシャープ: +0.3768
年間勝率: +70.00%

================================================================================
完了: STOP付cross4 Weights→Returns計算完了
================================================================================


[OK] backtest_from_weights_with_stop.py (planB, w60) 成功

================================================================================
[実行中] backtest_from_weights_with_stop.py (planB, w120)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\backtest_from_weights_with_stop.py --strategy planB --window 120
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== STOP付cross4 Weights→Returns計算 (PLANB, window=120) ===
================================================================================

[STEP 1] weightsを読み込み中: data\processed\weights\cross4_target_weights_planB_w120.parquet
  [OK] 236403 rows

[STEP 2] returnsを計算中...
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]

[OK] 保存: data\processed\weights_bt\cross4_from_weights_planB_w120.parquet

================================================================================
【パフォーマンス統計】
================================================================================
=== Plan B 120d ===
  Cumulative: 207.89%
  Annualized:  12.29%
  Alpha Sharpe:  0.24
  MaxDD: -25.03%


【Plan B 120d - 月次リターン（相対α）】
month    Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec      年間
year                                                                                             
2016  -1.20% +2.22% -1.99% +1.02% -0.16% +1.46% +3.70% +1.17% +0.64% -0.97% -0.51% -0.12%  +6.31%
2017  +0.37% +0.49% +0.34% -0.29% -2.59% +0.86% +1.00% -1.23% -2.00% -0.99% -0.89% +0.15%  -5.58%
2018  -0.86% +1.84% -0.76% -0.88% -0.18% +0.61% +0.93% +1.30% -4.59% +3.89% -1.25% +9.48%  +9.55%
2019  +1.97% -1.60% -1.64% +0.49% -1.14% +1.42% +2.53% -0.33% +0.03% -0.47% +0.45% -0.36%  +1.29%
2020  -0.81% +1.00% -3.01% -0.63% -4.02% -0.56% +2.49% -1.66% -2.97% -0.21% -1.67% +1.56% -10.13%
2021  +3.14% +2.25% -0.66% +1.36% +0.37% +0.05% +0.98% -0.91% -0.54% -0.27% -0.67% -1.94%  +3.53%
2022  +2.69% +1.93% +0.76% +1.69% +0.81% +1.25% +2.00% -0.35% +0.15% -0.26% +0.61% -0.20% +11.19%
2023  -0.70% +0.76% -1.99% +1.48% -1.78% -1.64% +2.77% +2.24% -1.38% -0.75% +2.72% +0.43%  +2.61%
2024  -0.28% -0.79% -0.84% -0.17% -1.11% +0.68% +1.41% -4.16% +0.66% +1.63% -0.65% -0.48%  -4.89%
2025  +0.45% +2.57% -0.19% +0.97% +0.41% +1.40% +1.88% -0.33% -1.66% -1.77% +1.93% +0.33%  +7.50%

【Plan B 120d - 年次リターン】
 year  port_return  tpx_return  rel_alpha
 2016      +15.75%      +9.44%     +6.31%
 2017      +16.76%     +22.34%     -5.58%
 2018       -8.23%     -17.77%     +9.55%
 2019      +16.55%     +15.26%     +1.29%
 2020       -4.97%      +5.16%    -10.13%
 2021      +14.12%     +10.59%     +3.53%
 2022       +6.42%      -4.77%    +11.19%
 2023      +27.94%     +25.32%     +2.61%
 2024      +13.07%     +17.96%     -4.89%
 2025      +27.58%     +20.08%     +7.50%

【Plan B 120d - 年次統計】
年率平均（Port）: +12.4983%
年率平均（TOPIX）: +10.3600%
年率平均（α）: +2.1383%
年率標準偏差（α）: +7.0342%
年率αシャープ: +0.3040
年間勝率: +70.00%

================================================================================
完了: STOP付cross4 Weights→Returns計算完了
================================================================================


[OK] backtest_from_weights_with_stop.py (planB, w120) 成功

[結果] backtest_from_weights_with_stop.py: 6/6 成功

================================================================================
[STEP 3] 比較を実行中...
================================================================================

================================================================================
[実行中] 比較 (stop0, w60)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\compare_eval_vs_weights_stop.py --strategy stop0 --window 60
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 比較 ===
Strategy: stop0, Window: 60
================================================================================

[STEP 1] eval_stop_regimes.pyの結果を読み込み中...
  [OK] 2421 日分
  期間: 2016-01-22 ～ 2025-12-18

[STEP 2] backtest_from_weights_with_stop.pyの結果を読み込み中...
  [OK] 2444 日分
  期間: 2016-01-25 ～ 2025-12-19

[STEP 3] 結果を比較中...

=== STOP0 (window=60) ===
Status: FAIL
共通日数: 2420 日
平均絶対差分: 0.0058067179
最大絶対差分: 0.0829365943
累積リターン (eval): 172.0261%
累積リターン (weights): 172.6619%
累積リターン差分: -0.6358%

差分が大きい日 Top10:
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff
2024-08-05       -0.03278594          -0.11572254 0.08293659
2024-08-06        0.00821528           0.08358371 0.07536843
2016-07-12        0.00000000           0.07188746 0.07188746
2025-04-10        0.00886563           0.07658934 0.06772371
2016-06-24        0.00000000          -0.06475484 0.06475484
2025-04-08       -0.00133149           0.06289805 0.06422954
2025-04-07       -0.01218512          -0.06941691 0.05723179
2018-12-25        0.00000000          -0.04481200 0.04481200
2020-03-25        0.04015628           0.00000000 0.04015628
2020-05-08        0.03793380           0.00000000 0.03793380

[INFO] 詳細比較結果を保存: data\processed\research\reports\eval_vs_weights_comparison_stop0_w60.parquet
[INFO] サマリーを保存: data\processed\research\reports\eval_vs_weights_comparison_summary.csv


[OK] 比較 (stop0, w60) 成功

================================================================================
[実行中] 比較 (stop0, w120)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\compare_eval_vs_weights_stop.py --strategy stop0 --window 120
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 比較 ===
Strategy: stop0, Window: 120
================================================================================

[STEP 1] eval_stop_regimes.pyの結果を読み込み中...
  [OK] 2421 日分
  期間: 2016-01-22 ～ 2025-12-18

[STEP 2] backtest_from_weights_with_stop.pyの結果を読み込み中...
  [OK] 2444 日分
  期間: 2016-01-25 ～ 2025-12-19

[STEP 3] 結果を比較中...

=== STOP0 (window=120) ===
Status: FAIL
共通日数: 2420 日
平均絶対差分: 0.0058278959
最大絶対差分: 0.0829365943
累積リターン (eval): 99.5366%
累積リターン (weights): 186.5992%
累積リターン差分: -87.0626%

差分が大きい日 Top10:
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff
2024-08-05       -0.03278594          -0.11572254 0.08293659
2016-07-12        0.00000000           0.07188746 0.07188746
2025-04-10        0.00886563           0.07658934 0.06772371
2025-04-08       -0.00133149           0.06289805 0.06422954
2025-04-07       -0.01218512          -0.06941691 0.05723179
2016-11-10        0.00000000           0.05056358 0.05056358
2020-03-09       -0.00645208          -0.05591312 0.04946104
2020-06-11       -0.04531039           0.00000000 0.04531039
2018-12-27        0.00000000           0.04244806 0.04244806
2020-03-25        0.04015628           0.00000000 0.04015628

[INFO] 詳細比較結果を保存: data\processed\research\reports\eval_vs_weights_comparison_stop0_w120.parquet
[INFO] サマリーを保存: data\processed\research\reports\eval_vs_weights_comparison_summary.csv


[OK] 比較 (stop0, w120) 成功

================================================================================
[実行中] 比較 (planA, w60)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\compare_eval_vs_weights_stop.py --strategy planA --window 60
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 比較 ===
Strategy: planA, Window: 60
================================================================================

[STEP 1] eval_stop_regimes.pyの結果を読み込み中...
  [OK] 2421 日分
  期間: 2016-01-22 ～ 2025-12-18

[STEP 2] backtest_from_weights_with_stop.pyの結果を読み込み中...
  [OK] 2444 日分
  期間: 2016-01-25 ～ 2025-12-19

[STEP 3] 結果を比較中...

=== PLANA (window=60) ===
Status: FAIL
共通日数: 2420 日
平均絶対差分: 0.0055969851
最大絶対差分: 0.0907663292
累積リターン (eval): 184.6015%
累積リターン (weights): 221.0586%
累積リターン差分: -36.4570%

差分が大きい日 Top10:
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff
2024-08-05       -0.03278594          -0.12355227 0.09076633
2024-08-06        0.00821528           0.08966788 0.08145260
2025-04-10        0.00886563           0.08277953 0.07391389
2025-04-08       -0.00133149           0.06801084 0.06934232
2025-04-07       -0.01218512          -0.07745268 0.06526757
2018-12-25        0.00025479          -0.04858423 0.04883902
2020-03-24       -0.00574317           0.03780440 0.04354757
2016-07-12        0.03338868           0.07401993 0.04063126
2025-04-09        0.00105353          -0.03780157 0.03885510
2018-12-27        0.00808604           0.04616201 0.03807597

[INFO] 詳細比較結果を保存: data\processed\research\reports\eval_vs_weights_comparison_planA_w60.parquet
[INFO] サマリーを保存: data\processed\research\reports\eval_vs_weights_comparison_summary.csv


[OK] 比較 (planA, w60) 成功

================================================================================
[実行中] 比較 (planA, w120)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\compare_eval_vs_weights_stop.py --strategy planA --window 120
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 比較 ===
Strategy: planA, Window: 120
================================================================================

[STEP 1] eval_stop_regimes.pyの結果を読み込み中...
  [OK] 2421 日分
  期間: 2016-01-22 ～ 2025-12-18

[STEP 2] backtest_from_weights_with_stop.pyの結果を読み込み中...
  [OK] 2444 日分
  期間: 2016-01-25 ～ 2025-12-19

[STEP 3] 結果を比較中...

=== PLANA (window=120) ===
Status: FAIL
共通日数: 2420 日
平均絶対差分: 0.0056173403
最大絶対差分: 0.0907663292
累積リターン (eval): 147.2304%
累積リターン (weights): 221.1023%
累積リターン差分: -73.8719%

差分が大きい日 Top10:
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff
2024-08-05       -0.03278594          -0.12355227 0.09076633
2025-04-10        0.00886563           0.08277953 0.07391389
2025-04-08       -0.00133149           0.06801084 0.06934232
2025-04-07       -0.01218512          -0.07745268 0.06526757
2020-03-09       -0.00645208          -0.06066208 0.05420999
2018-12-27       -0.00623055           0.04616201 0.05239256
2016-11-10        0.00938656           0.05647551 0.04708896
2025-04-04        0.01166369          -0.03376425 0.04542794
2020-03-24       -0.00574317           0.03780440 0.04354757
2016-07-12        0.03338868           0.07401993 0.04063126

[INFO] 詳細比較結果を保存: data\processed\research\reports\eval_vs_weights_comparison_planA_w120.parquet
[INFO] サマリーを保存: data\processed\research\reports\eval_vs_weights_comparison_summary.csv


[OK] 比較 (planA, w120) 成功

================================================================================
[実行中] 比較 (planB, w60)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\compare_eval_vs_weights_stop.py --strategy planB --window 60
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 比較 ===
Strategy: planB, Window: 60
================================================================================

[STEP 1] eval_stop_regimes.pyの結果を読み込み中...
  [OK] 2421 日分
  期間: 2016-01-22 ～ 2025-12-18

[STEP 2] backtest_from_weights_with_stop.pyの結果を読み込み中...
  [OK] 2444 日分
  期間: 2016-01-25 ～ 2025-12-19

[STEP 3] 結果を比較中...

=== PLANB (window=60) ===
Status: FAIL
共通日数: 2420 日
平均絶対差分: 0.0053950733
最大絶対差分: 0.0829365943
累積リターン (eval): 192.4394%
累積リターン (weights): 197.0464%
累積リターン差分: -4.6070%

差分が大きい日 Top10:
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff
2024-08-05       -0.03278594          -0.11572254 0.08293659
2024-08-06        0.00821528           0.08358371 0.07536843
2025-04-10        0.00886563           0.07658934 0.06772371
2025-04-08       -0.00133149           0.06289805 0.06422954
2025-04-07       -0.01218512          -0.06941691 0.05723179
2016-07-12        0.02623973           0.07188746 0.04564773
2018-12-25       -0.00784523          -0.04481200 0.03696677
2025-04-09        0.00105353          -0.03495721 0.03601074
2020-03-24       -0.00574317           0.02914429 0.03488746
2018-12-27        0.00808604           0.04244806 0.03436202

[INFO] 詳細比較結果を保存: data\processed\research\reports\eval_vs_weights_comparison_planB_w60.parquet
[INFO] サマリーを保存: data\processed\research\reports\eval_vs_weights_comparison_summary.csv


[OK] 比較 (planB, w60) 成功

================================================================================
[実行中] 比較 (planB, w120)
================================================================================
コマンド: C:\Users\sohta\AppData\Local\Programs\Python\Python38\python.exe scripts\analysis\compare_eval_vs_weights_stop.py --strategy planB --window 120
作業ディレクトリ: C:\Users\sohta\equity01
================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 比較 ===
Strategy: planB, Window: 120
================================================================================

[STEP 1] eval_stop_regimes.pyの結果を読み込み中...
  [OK] 2421 日分
  期間: 2016-01-22 ～ 2025-12-18

[STEP 2] backtest_from_weights_with_stop.pyの結果を読み込み中...
  [OK] 2444 日分
  期間: 2016-01-25 ～ 2025-12-19

[STEP 3] 結果を比較中...

=== PLANB (window=120) ===
Status: FAIL
共通日数: 2420 日
平均絶対差分: 0.0054195844
最大絶対差分: 0.0829365943
累積リターン (eval): 150.0828%
累積リターン (weights): 204.9867%
累積リターン差分: -54.9038%

差分が大きい日 Top10:
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff
2024-08-05       -0.03278594          -0.11572254 0.08293659
2025-04-10        0.00886563           0.07658934 0.06772371
2025-04-08       -0.00133149           0.06289805 0.06422954
2025-04-07       -0.01218512          -0.06941691 0.05723179
2020-03-09       -0.00645208          -0.05591312 0.04946104
2016-07-12        0.02623973           0.07188746 0.04564773
2018-12-27        0.00404302           0.04244806 0.03840504
2025-04-09        0.00105353          -0.03495721 0.03601074
2020-06-11       -0.04531039          -0.00934951 0.03596088
2016-11-10        0.01547599           0.05056358 0.03508759

[INFO] 詳細比較結果を保存: data\processed\research\reports\eval_vs_weights_comparison_planB_w120.parquet
[INFO] サマリーを保存: data\processed\research\reports\eval_vs_weights_comparison_summary.csv


[OK] 比較 (planB, w120) 成功

[結果] 比較: 6/6 成功

================================================================================
=== 実行サマリー ===
================================================================================
backtest実行: 6/6
比較実行: 6/6

[OK] 全ての比較が完了しました
詳細は data/processed/research/reports/eval_vs_weights_comparison_summary.csv を確認してください
ログファイル: C:\Users\sohta\equity01\data\processed\research\reports\run_all_stop_comparison.log
