# equity01  
## Staging / Production 要件定義書・開発計画書  
**Version 1.0 / 2025-12**

---

## 0. 本書の目的と位置づけ

本書は equity01 における **stg（ステージング）／prd（本番）環境**の  
要件・設計・開発計画・運用ルールを定義する公式ドキュメントである。

本書は以下を兼ねる：

- stg / prd の **要件定義書**
- stg / prd の **開発計画書**
- 定期レビュー（四半期）および  
  パフォーマンス報告書の **基準文書**

---

## 1. 環境定義

### 1.1 dev（研究環境）
- 役割：variant探索・仮説検証
- 許可：構造変更・パラメータ探索
- 禁止：実弾前提の判断

---

### 1.2 stg（ステージング環境）
**目的**
- dev で確定した戦略を  
  **本番と同一条件で検証・固定**する

**役割**
- 実行フロー確認
- 実務負荷・回転率・コスト確認
- prd への昇格判断

**禁止事項**
- variant探索
- 複数案の同時検証
- Sharpe 最大化調整

---

### 1.3 prd（本番環境）
**目的**
- 小額実弾での **安定稼働と長期観測**

**役割**
- 実運用
- ログ蓄積
- レビュー素材生成

**禁止事項**
- 平日のコード変更
- 平日のパラメータ変更
- 改善・最適化行為

---

## 2. 戦略要件（stg / prd 共通・凍結）

### 2.1 採用戦略
- ベース戦略：cross4
- ホライゾン：H60 / H90 / H120
- アンサンブル：固定ウェイト（dev確定）

### 2.2 STOP Regime（正式仕様）
- 判定指標：cross4 60日ローリングリターン
- 判定頻度：月次（原則）
- STOP OFF：cross4 100%
- STOP ON：cross4 75% + TOPIX inverse 25%

### 2.3 データソース
- シグナル計算：Yahoo Finance（日次終値）
- 約定：SBI証券（S株・成行）

---

## 3. 開発定義（stg / prd）

### 3.1 コード構造ルール
- 本番実行コードは `apps/` 配下のみ
- `research/` は stg / prd で参照禁止
- 設定値はすべて `config/` に集約

### 3.2 変更ルール
| 項目 | 平日 | 土日 |
|---|---|---|
| コード変更 | ❌ | ❌ |
| config（yaml） | ❌ | ⭕ |
| 実行ON/OFF | ⭕ | ⭕ |

---

## 4. デプロイ要件

### 4.1 初期デプロイ
1. Git clone
2. setup.ps1 実行
3. config 確認
4. DRY_RUN 実行

### 4.2 安全装置（必須）
- DRY_RUN フラグ
- 最大DDガード
- 最大取引数制限
- データ欠損時は **売買しない**

---

## 5. 運用要件

### 5.1 日次運用（平日・5分）
- 当日損益
- STOP ON/OFF
- 約定数
- エラー有無

### 5.2 週次運用（週末）
- 週次損益
- 入替率
- inverse 使用状況
- ログ確認

---

## 6. レビュー・メンテナンス要件（公式）

### 6.1 四半期レビュー
1. パフォーマンス健全性  
   - 年率 / Sharpe / MaxDD / α Sharpe
2. STOP Regime 健全性  
   - STOP率 / 連続日数 / 騙し率
3. 取引コスト・回転率
4. 寄与度分析  
   - ホライゾン別  
   - STOP / 非STOP別
5. βとの関係（投信・旗艦β）

### 6.2 半期レビュー
- データ欠損
- ユニバース健全性
- インデックス乖離

---

## 7. prd / stg → dev 還流ルール

prd / stg から dev への還流は  
**仮説ではなく観測事実のみ**とする。


### [prd→dev 還流]
- 発生期間：
- 区分：STOP / 寄与 / コスト / 実務 / β
- 事実：
- 体感影響度：小 / 中 / 大
8. 開発計画・スケジュール
Phase 1：dev 整備（〜今月）
不要コード整理（researchへ隔離）

apps / libs / config 構造確定

variant探索テンプレ整備

Phase 2：stg 固定（6月）
JP-stg ブランチ確定

config 凍結

月次STOP判定確認

実行・入力負荷実測

Phase 3：prd 稼働開始（7〜8月）
JP-prd ブランチ作成（stgから）

小額実弾開始

週末レビュー運用開始

還流ログ運用開始

9. prd 継続判定基準
以下をすべて満たした場合、prd を正式継続：

発注・実行が破綻しない

STOP がガチャガチャしない

コストが想定内

家計・心理負荷が許容範囲

修正衝動を土日まで抑制可能

10. 運用方針（最重要）
prd は改善しない。観測する。
改善は dev で行い、昇格は stg を経由する。

Prepared for equity01
Staging / Production Requirements & Development Plan
