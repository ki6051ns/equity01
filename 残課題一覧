# equity01 残課題一覧 & 対応状況（2025/11/30 時点）
8th_commit + 9th_commit の成果を反映した最新版。

---

# 1. データ基盤（Raw / Processed）

| 項目 | 内容 | 状況 |
|------|------|------|
| 複数銘柄の parquet 化 | 27銘柄 → 94銘柄へ変換 | ✔ 完了（6th） |
| ユニバーススナップショット | 月次/四半期で universe 保存 | ⏳ 未実装 |
| 東証休日カレンダー完全対応 | 祝日/臨時休場/米国休場含む | 🔜 event01 前に必須 |
| Cutoff Policy（D-1 08:00 JST） | NY引け → 東京朝確定 | ✔ 完了 |
| NY祝日対応 | FX/VIX/先物の欠損吸収 | ⏳ 未実装 |

---

# 2. Feature Builder（特徴量）

| 項目 | 内容 | 状況 |
|------|------|------|
| 基本シグナル（ret/vol/adv） | ret_5 / ret_20 / vol_20 / ADV | ✔ |
| 出来高加速（volume acceleration） | ADV比の速度 | ⏳ |
| 過熱抑制 flag（heat_flag） | z-score ベース | ✔ |
| Quick-FA（EPS, ROIC等） | 速報系ファンダ | ❌ 別フェーズ |
| strength（廃止） | 不要と判断 | ⚠️ 廃止 |

---

# 3. Scoring Engine（スコアリング）

| 項目 | 内容 | 状況 |
|------|------|------|
| Z-score 正規化 | bucket 内で標準化 | ✔ |
| 特性ペナルティ | 流動性, 過熱, vol | ✔ |
| σ補正（σ^β） | weight補正 | ✔ |
| size bucket 正規化 | Large/Mid/Small で均等化 | ✔ |
| top N 選抜 | スコア上位採用 | ✔ |
| daily_feature_scores 保存 | parquet 化 | ✔ |
| weighting_scheme | equal/score/zscore | ✔ |

---

# 4. Portfolio Builder（PF生成）

| 項目 | 内容 | 状況 |
|------|------|------|
| size bucket 分類 | 流動性分位 | ✔ |
| weight 正規化 | 等金額 or z-score | ✔ |
| max_names（ポジション数） | 30（安定設定） | ✔ |
| decision_date / trading_date | cutoff反映 | ✔ |
| β制御（ETF階段制御） | 0.6/0.4/0.2 など | ⏳ 未実装 |
| レバレッジ管理（VAR ≤ 2%） | VARベース | ❌ 未着手 |

---

# 5. EventGuard（イベント反射層）

| バージョン | 内容 | 状況 |
|------------|------|------|
| v0.1 | skeleton | ✔ |
| v0.2 | flag_earnings / soft_guard | ✔（7th） |
| v1.1 | must-kill設計（FOMC/SQ/BOJ）＋前日引けヘッジ | ✔（8th） |
| v0.3 | 先物・為替・VIX の閾値判定 | ⏳ |
| v0.4 | BOJ/FOMC の LLMスコアリング | ❌ |
| v1.0 | Guard 層全体統合（ALPHAERS連結） | 🔜 2026Q1 |

---

# 6. レジーム判定（market regimes）

| 項目 | 内容 | 状況 |
|------|------|------|
| equity01 内部レジーム | Momentum × VIX の簡易版 | ⚠️ 廃止（不要） |
| ALPHAERS 側レジーム | 戦略横断の判定に移管 | ✔ 方針確定 |
| breadth PCA | 市場広さで regime | ⏳ |
| HMM 2/3 state | 上昇/下降/ボラ | ❌ 未着手 |

---

# 7. Intraweek Overlay（週内ロジック）

| 項目 | 内容 | 状況 |
|------|------|------|
| 月→木：通常 | 稼働 | 🔄 検討中 |
| 木→金：軽度縮小 | 金曜イベント回避 | ⏳ |
| 金→月：禁止/縮小 | WE跨ぎリスク | ⏳ |
| 週内 β階段 | 0.5→0.35→0.2 | ❌ 未実装 |

---

# 8. ペーパートレード（単体テスト基盤）

| 項目 | 内容 | 状況 |
|------|------|------|
| fwd return（D→D+1） | feature builderで生成 | ✔ |
| daily_trade.csv | 出力正常 | ✔ |
| Sharpe/DD/Exposure | QA基盤 | ✔ |
| 94銘柄 backtest | 2015-2025 完走 | ✔ |
| explainability（勝因/敗因） | LLM で文章生成 | ⏳ |
| relative α（calc_alpha_beta） | Port vs TOPIX | ✔（9th） |

---

# 9. 品質保証（QA）

| 項目 | 内容 | 状況 |
|------|------|------|
| Why 投資判断（説明可能性） | QA基準策定 | ✔ |
| 市場環境との整合性 | 外部要因照合 | 🔄 |
| 非合理挙動の切り分け | スコア vs レジーム | 🔄 |
| スコア分布チェック | hist, QQ | ✔ |
| 銘柄寄与度 | factor使用 | 未実装 |

---

# 10. 外部接続（β・指数・ETF）

| 項目 | 内容 | 状況 |
|------|------|------|
| index loader（TOPIX/225） | daily_loader | ⏳ |
| ETF loader（1570, 1306） | β制御用 | ⏳ |
| β計算（cov/var） | β_neutral / β_target | ❌ |
| 相関行列（11資産） | ALPHAERS側で利用 | 🔜 |

---

# 11. その他

| 項目 | 内容 | 状況 |
|------|------|------|
| ログ最適化 | print → logger | ⏳ |
| エラー吸収 | feature builder改善済 | ✔ |
| outlier処理 | price jump, zero volume | ⏳ |
| スコア世代管理 | scores_YYYYMMDD | ✔ |
| backtest高速化 | vectorize / merge削減 | 🔜 |

---

# 🔎 優先度（A/B/C）

## **A：最優先（10th_commit〜）**
- EventGuard v0.3（先物・為替・VIX 閾値）
- β制御（ETF 階段）
- Intraweek Overlay（木→金、金→月）
- レジーム判定（ALPHAERS 側の中核へ）
- NY祝日対応＋cutoff 完全対応

## **B：次優先（品質強化）**
- スコア分布 QA / 因果性分析
- 勝因/敗因の自動説明（LLM）
- ユニバーススナップショット（月次）

## **C：中期（2026Q1〜）**
- breadth PCA
- HMM（2–3 state）
- Multi-Horizon Ensemble
- パラメータアンサンブル（zscore × score）
- VAR/レバレッジ管理

---

# 🧩 現状の到達点（まとめ）

- 6th〜7th で **戦略単体として動く最低要件** が完成  
  → price → feature → scoring → PF → Guard → paper_trade が自動化
- 8th〜9th で  
  - **守り（EventGuard v1.1）**  
  - **測定（relative α）**  
  - **標準化（Returnベース）**  
  を実装し、戦略評価の基盤がほぼ完成。

次フェーズは **攻め：  
ホライゾンアンサンブル × パラメータアンサンブル × β制御 × Intraweek**。

*Prepared by equity01 / Strategy Core Layer*  
