================================================================================
=== eval_stop_regimes vs backtest_from_weights_with_stop 差分詳細分析（全量実行） ===
================================================================================

[STEP 0] 差分が大きい日を抽出中...
  STOP0 w60: 10 日抽出
  STOP0 w120: 10 日抽出
  PLANA w60: 10 日抽出
  PLANA w120: 10 日抽出
  PLANB w60: 10 日抽出
  PLANB w120: 10 日抽出

================================================================================
=== STOP0 (window=60) の分析 ===
================================================================================

[分析 1/3] 2024-08-05
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: STOP0 (window=60), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01471011 0.00914317      False  0.01522577
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.08358372 0.07536844      False  0.06043839
2024-08-07       -0.00082378           0.02217924 0.02300302      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1157225280
  差分:                 0.0829365841
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02300154 -0.20252830   -0.00465846
7014.T 0.01521991 -0.24676121   -0.00375568
6504.T 0.02394676 -0.14100972   -0.00337673
7270.T 0.01612269 -0.18338639   -0.00295668
9984.T 0.01574846 -0.18657853   -0.00293832
3086.T 0.01780864 -0.16414471   -0.00292319
6472.T 0.01827160 -0.15722574   -0.00287277
6305.T 0.01986883 -0.14291946   -0.00283964
8031.T 0.01317901 -0.19868423   -0.00261846
1469.T 0.01328704  0.19643793    0.00261008

  合計寄与（絶対値）: 0.1299707526
  計算されたport_ret: -0.1157225280
  weights側のport_ret: -0.1157225280
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1469.T         0.01690989            0.00261008         0.01429982
1356.T         0.01586777            0.00243784         0.01342992
1569.T         0.00924064            0.00207619         0.00716445
9104.T        -0.00747640           -0.00172856        -0.00574784
8308.T        -0.00656938           -0.00101437        -0.00555501
6361.T                NaN           -0.00465846         0.00465846
7182.T        -0.00546670           -0.00122628        -0.00424042
9101.T        -0.00528487           -0.00124541        -0.00403946
7014.T                NaN           -0.00375568         0.00375568
9983.T        -0.00421962           -0.00074949        -0.00347013

  合計寄与差分: 0.0829365841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.08293658, no_pattern_improves >10%

[分析 2/3] 2024-08-06
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: STOP0 (window=60), 対象日=2024-08-06 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-08-01 ～ 2024-08-09

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.08358372 0.07536844      False  0.06043839
2024-08-07       -0.00082378           0.02217924 0.02300302      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991
2024-08-09        0.00100726           0.00876930 0.00776204      False  0.01057160

[STEP 3] 対象日 2024-08-06 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0082152774
  port_ret_cc_weights: 0.0835837177
  差分:                 -0.0753684403
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02321759  0.17899608    0.00415586
6504.T 0.02413966  0.16015373    0.00386606
6723.T 0.01537037  0.19061664    0.00292985
3086.T 0.01801698  0.13695407    0.00246750
6861.T 0.01373843  0.17658129    0.00242595
4901.T 0.01443673  0.15984045    0.00230757
4689.T 0.02250772  0.09740255    0.00219231
7735.T 0.01722608  0.12499985    0.00215326
1356.T 0.01314043 -0.15992220   -0.00210145
6902.T 0.01510417  0.13773895    0.00208043

  合計寄与（絶対値）: 0.0969703410
  計算されたport_ret: 0.0835837177
  weights側のport_ret: 0.0835837177
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08054626 -0.15992220   -0.01288113
1469.T 0.08054626 -0.14273201   -0.01149653
1569.T 0.08054626 -0.11695906   -0.00942061
9104.T 0.03158013  0.15106093    0.00477052
9101.T 0.02944978  0.13431718    0.00395561
9983.T 0.04340733  0.07814630    0.00339212
6758.T 0.02688296  0.09127165    0.00245365
6501.T 0.01467772  0.16617214    0.00243903
4578.T 0.04491360  0.05240120    0.00235353
8267.T 0.04148621  0.05130592    0.00212849

  [統計]
    合計寄与（port_ret再構築）: 0.0082152774
    eval側のport_ret: 0.0082152774
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 45

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01288113           -0.00210145        -0.01077969
1469.T        -0.01149653           -0.00188437        -0.00961216
1569.T        -0.00942061           -0.00158743        -0.00783318
6361.T                NaN            0.00415586        -0.00415586
6504.T                NaN            0.00386606        -0.00386606
9104.T         0.00477052            0.00178044         0.00299008
6723.T                NaN            0.00292985        -0.00292985
9983.T         0.00339212            0.00060871         0.00278341
9101.T         0.00395561            0.00127840         0.00267721
3086.T                NaN            0.00246750        -0.00246750

  合計寄与差分: -0.0753684403

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:close, na:zero, cause:1:date_alignment,4:price_diff | diff_original:0.07536844, diff_best:0.05152467, improvement:31.6%

[分析 3/3] 2016-07-12
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: STOP0 (window=60), 対象日=2016-07-12 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2016-07-07 ～ 2016-07-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2016-07-07        0.00000000          -0.00461575 0.00461575       True -0.00479233
2016-07-08        0.00000000          -0.00812884 0.00812884       True -0.01524878
2016-07-11        0.00000000          -0.00205387 0.00205387       True  0.03911984
2016-07-12        0.00000000           0.07188745 0.07188745       True  0.02588236
2016-07-13        0.00000000           0.00000000 0.00000000       True  0.00917435
2016-07-14        0.00000000           0.00485688 0.00485688       True  0.00833333
2016-07-15        0.00000000           0.01236777 0.01236777       True  0.00375652

[STEP 3] 対象日 2016-07-12 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0000000000
  port_ret_cc_weights: 0.0718874508
  差分:                 -0.0718874508
  STOPフラグ:          True

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight        ret  contribution
6472.T 0.02889049 0.13991770    0.00404229
6473.T 0.02075750 0.14121037    0.00293117
7974.T 0.00712590 0.40381081    0.00287752
7014.T 0.02832429 0.08249508    0.00233661
8601.T 0.01782288 0.12745649    0.00227164
6723.T 0.01856109 0.10961552    0.00203458
8750.T 0.01660893 0.11122093    0.00184726
8604.T 0.01751663 0.09784470    0.00171391
8697.T 0.01194125 0.14112526    0.00168521
7270.T 0.01546456 0.10766422    0.00166498

  合計寄与（絶対値）: 0.0748689005
  計算されたport_ret: 0.0718874508
  weights側のport_ret: 0.0718874508
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
7974.T 0.07585175  0.40381081    0.03062976
6701.T 0.03146312  0.10121472    0.00318453
1469.T 0.05749999 -0.04840104   -0.00278306
1356.T 0.05413317 -0.04890388   -0.00264732
8035.T 0.04450912  0.04735014    0.00210751
9766.T 0.03215341  0.06172815    0.00198477
9007.T 0.05285302  0.03675815    0.00194278
7011.T 0.02707448  0.07084132    0.00191799
6861.T 0.03896186  0.04440665    0.00173017
2413.T 0.03124780  0.04526757    0.00141451

  [統計]
    合計寄与（port_ret再構築）: 0.0524794667
    eval側のport_ret: 0.0000000000
    差分: 0.0524794667
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 46

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
7974.T         0.03062976            0.00287752         0.02775224
6472.T                NaN            0.00404229        -0.00404229
6473.T                NaN            0.00293117        -0.00293117
7014.T                NaN            0.00233661        -0.00233661
6701.T         0.00318453            0.00086885         0.00231568
8601.T                NaN            0.00227164        -0.00227164
1356.T        -0.00264732           -0.00039612        -0.00225120
6723.T                NaN            0.00203458        -0.00203458
1469.T        -0.00278306           -0.00081728        -0.00196578
8750.T                NaN            0.00184726        -0.00184726

  合計寄与差分: -0.0194079841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:lag, price:close, na:zero, cause:4:price_diff | diff_original:0.07188745, diff_best:0.01940797, improvement:73.0%

================================================================================
=== STOP0 (window=120) の分析 ===
================================================================================

[分析 1/3] 2024-08-05
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: STOP0 (window=120), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01471011 0.00914317      False  0.01522577
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.00000000 0.00821528      False  0.06043839
2024-08-07       -0.00082378           0.00000000 0.00082378      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1157225280
  差分:                 0.0829365841
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02300154 -0.20252830   -0.00465846
7014.T 0.01521991 -0.24676121   -0.00375568
6504.T 0.02394676 -0.14100972   -0.00337673
7270.T 0.01612269 -0.18338639   -0.00295668
9984.T 0.01574846 -0.18657853   -0.00293832
3086.T 0.01780864 -0.16414471   -0.00292319
6472.T 0.01827160 -0.15722574   -0.00287277
6305.T 0.01986883 -0.14291946   -0.00283964
8031.T 0.01317901 -0.19868423   -0.00261846
1469.T 0.01328704  0.19643793    0.00261008

  合計寄与（絶対値）: 0.1299707526
  計算されたport_ret: -0.1157225280
  weights側のport_ret: -0.1157225280
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1469.T         0.01690989            0.00261008         0.01429982
1356.T         0.01586777            0.00243784         0.01342992
1569.T         0.00924064            0.00207619         0.00716445
9104.T        -0.00747640           -0.00172856        -0.00574784
8308.T        -0.00656938           -0.00101437        -0.00555501
6361.T                NaN           -0.00465846         0.00465846
7182.T        -0.00546670           -0.00122628        -0.00424042
9101.T        -0.00528487           -0.00124541        -0.00403946
7014.T                NaN           -0.00375568         0.00375568
9983.T        -0.00421962           -0.00074949        -0.00347013

  合計寄与差分: 0.0829365841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.08293658, no_pattern_improves >10%

[分析 2/3] 2016-07-12
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: STOP0 (window=120), 対象日=2016-07-12 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2016-07-07 ～ 2016-07-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2016-07-07        0.00000000          -0.00461575 0.00461575       True -0.00479233
2016-07-08        0.00000000          -0.00812884 0.00812884       True -0.01524878
2016-07-11        0.00000000          -0.00205387 0.00205387       True  0.03911984
2016-07-12        0.00000000           0.07188745 0.07188745       True  0.02588236
2016-07-13        0.00376888           0.01318185 0.00941297      False  0.00917435
2016-07-14        0.02277647           0.00485688 0.01791959      False  0.00833333
2016-07-15        0.02095737           0.01236777 0.00858960      False  0.00375652

[STEP 3] 対象日 2016-07-12 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0000000000
  port_ret_cc_weights: 0.0718874508
  差分:                 -0.0718874508
  STOPフラグ:          True

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight        ret  contribution
6472.T 0.02889049 0.13991770    0.00404229
6473.T 0.02075750 0.14121037    0.00293117
7974.T 0.00712590 0.40381081    0.00287752
7014.T 0.02832429 0.08249508    0.00233661
8601.T 0.01782288 0.12745649    0.00227164
6723.T 0.01856109 0.10961552    0.00203458
8750.T 0.01660893 0.11122093    0.00184726
8604.T 0.01751663 0.09784470    0.00171391
8697.T 0.01194125 0.14112526    0.00168521
7270.T 0.01546456 0.10766422    0.00166498

  合計寄与（絶対値）: 0.0748689005
  計算されたport_ret: 0.0718874508
  weights側のport_ret: 0.0718874508
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
7974.T 0.07585175  0.40381081    0.03062976
6701.T 0.03146312  0.10121472    0.00318453
1469.T 0.05749999 -0.04840104   -0.00278306
1356.T 0.05413317 -0.04890388   -0.00264732
8035.T 0.04450912  0.04735014    0.00210751
9766.T 0.03215341  0.06172815    0.00198477
9007.T 0.05285302  0.03675815    0.00194278
7011.T 0.02707448  0.07084132    0.00191799
6861.T 0.03896186  0.04440665    0.00173017
2413.T 0.03124780  0.04526757    0.00141451

  [統計]
    合計寄与（port_ret再構築）: 0.0524794667
    eval側のport_ret: 0.0000000000
    差分: 0.0524794667
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 46

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
7974.T         0.03062976            0.00287752         0.02775224
6472.T                NaN            0.00404229        -0.00404229
6473.T                NaN            0.00293117        -0.00293117
7014.T                NaN            0.00233661        -0.00233661
6701.T         0.00318453            0.00086885         0.00231568
8601.T                NaN            0.00227164        -0.00227164
1356.T        -0.00264732           -0.00039612        -0.00225120
6723.T                NaN            0.00203458        -0.00203458
1469.T        -0.00278306           -0.00081728        -0.00196578
8750.T                NaN            0.00184726        -0.00184726

  合計寄与差分: -0.0194079841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:lag, price:close, na:zero, cause:4:price_diff | diff_original:0.07188745, diff_best:0.01940797, improvement:73.0%

[分析 3/3] 2025-04-10
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: STOP0 (window=120), 対象日=2025-04-10 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-07 ～ 2025-04-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-07       -0.01218512          -0.06941691 0.05723179      False -0.07614887
2025-04-08       -0.00133149           0.06289805 0.06422954      False  0.06022608
2025-04-09        0.00105353          -0.03495721 0.03601074      False -0.03373402
2025-04-10        0.00886563           0.07658934 0.06772370      False  0.08406901
2025-04-11        0.00000000          -0.02428118 0.02428118       True -0.03127891
2025-04-14        0.00000000           0.00590992 0.00590992       True  0.00878870
2025-04-15        0.00000000           0.00840334 0.00840334       True  0.01041663

[STEP 3] 対象日 2025-04-10 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0088656328
  port_ret_cc_weights: 0.0765893374
  差分:                 -0.0677237045
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02834105  0.14184392    0.00402001
6504.T 0.02310957  0.11075654    0.00255954
1356.T 0.01567901 -0.16177577   -0.00253648
1469.T 0.01544753 -0.15990449   -0.00247013
6723.T 0.01571759  0.15686275    0.00246550
6501.T 0.01666281  0.14426633    0.00240388
7259.T 0.02491127  0.09632852    0.00239967
6472.T 0.02473765  0.09291573    0.00229852
7012.T 0.01401620  0.15487065    0.00217070
6473.T 0.02388889  0.08933713    0.00213416

  合計寄与（絶対値）: 0.0890635380
  計算されたport_ret: 0.0765893374
  weights側のport_ret: 0.0765893374
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08548409 -0.16177577   -0.01382925
1469.T 0.08548409 -0.15990449   -0.01366929
1569.T 0.07338692 -0.08048868   -0.00590682
9766.T 0.03083289  0.11055431    0.00340871
9433.T 0.05529582  0.05887302    0.00325543
8267.T 0.04594420  0.05221725    0.00239908
7974.T 0.01880943  0.11695897    0.00219993
9983.T 0.02332989  0.09056774    0.00211294
9020.T 0.04182056  0.05008459    0.00209457
9501.T 0.03154900  0.06197186    0.00195515

  [統計]
    合計寄与（port_ret再構築）: 0.0088656328
    eval側のport_ret: 0.0088656328
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 47

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01382925           -0.00253648        -0.01129277
1469.T        -0.01366929           -0.00247013        -0.01119916
1569.T        -0.00590682           -0.00116137        -0.00474544
6361.T                NaN            0.00402001        -0.00402001
9433.T         0.00325543            0.00049969         0.00275574
6504.T                NaN            0.00255954        -0.00255954
6723.T                NaN            0.00246550        -0.00246550
9766.T         0.00340871            0.00094432         0.00246439
6501.T                NaN            0.00240388        -0.00240388
7259.T                NaN            0.00239967        -0.00239967

  合計寄与差分: -0.0677237045

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:adj, na:zero, cause:1:date_alignment | diff_original:0.06772370, diff_best:0.01004340, improvement:85.2%

================================================================================
=== PLANA (window=60) の分析 ===
================================================================================

[分析 1/3] 2024-08-05
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANA (window=60), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01596633 0.01039939      False  0.01522577
2024-08-01       -0.02924373          -0.03594044 0.00669671      False -0.03258061
2024-08-02       -0.04968531          -0.05499560 0.00531029      False -0.06111902
2024-08-05       -0.03278594          -0.12355226 0.09076632      False -0.10817993
2024-08-06        0.00821528           0.08966789 0.08145261      False  0.06043839
2024-08-07       -0.00082378           0.02400845 0.02483224      False  0.03712618
2024-08-08       -0.00102468          -0.01119061 0.01016594      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1235522626
  差分:                 0.0907663188
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02363584 -0.20252830   -0.00478693
7014.T 0.01563962 -0.24676121   -0.00385925
6504.T 0.02460713 -0.14100972   -0.00346984
7270.T 0.01656729 -0.18338639   -0.00303822
9984.T 0.01618274 -0.18657853   -0.00301935
3086.T 0.01829974 -0.16414471   -0.00300381
6472.T 0.01877547 -0.15722574   -0.00295199
6305.T 0.02041674 -0.14291946   -0.00291795
8031.T 0.01354244 -0.19868423   -0.00269067
1469.T 0.01365345  0.19643793    0.00268205

  合計寄与（絶対値）: 0.1289163723
  計算されたport_ret: -0.1235522626
  weights側のport_ret: -0.1235522626
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T         0.01586777            0.00000000         0.01586777
1469.T         0.01690989            0.00268205         0.01422784
1569.T         0.00924064            0.00000000         0.00924064
9104.T        -0.00747640           -0.00177623        -0.00570017
8308.T        -0.00656938           -0.00104235        -0.00552704
6361.T                NaN           -0.00478693         0.00478693
7182.T        -0.00546670           -0.00126009        -0.00420661
9101.T        -0.00528487           -0.00127976        -0.00400511
7014.T                NaN           -0.00385925         0.00385925
6504.T                NaN           -0.00346984         0.00346984

  合計寄与差分: 0.0907663188

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.09076632, no_pattern_improves >10%

[分析 2/3] 2024-08-06
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANA (window=60), 対象日=2024-08-06 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-08-01 ～ 2024-08-09

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-08-01       -0.02924373          -0.03594044 0.00669671      False -0.03258061
2024-08-02       -0.04968531          -0.05499560 0.00531029      False -0.06111902
2024-08-05       -0.03278594          -0.12355226 0.09076632      False -0.10817993
2024-08-06        0.00821528           0.08966789 0.08145261      False  0.06043839
2024-08-07       -0.00082378           0.02400845 0.02483224      False  0.03712618
2024-08-08       -0.00102468          -0.01119061 0.01016594      False -0.01160991
2024-08-09        0.00100726           0.00925493 0.00824767      False  0.01057160

[STEP 3] 対象日 2024-08-06 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0082152774
  port_ret_cc_weights: 0.0896678901
  差分:                 -0.0814526127
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight        ret  contribution
6361.T 0.02385483 0.17899608    0.00426992
6504.T 0.02480220 0.16015373    0.00397217
6723.T 0.01579223 0.19061664    0.00301026
3086.T 0.01851147 0.13695407    0.00253522
6861.T 0.01411549 0.17658129    0.00249253
4901.T 0.01483296 0.15984045    0.00237091
4689.T 0.02312547 0.09740255    0.00225248
7735.T 0.01769887 0.12499985    0.00221236
6902.T 0.01551872 0.13773895    0.00213753
8035.T 0.01274001 0.16594879    0.00211419

  合計寄与（絶対値）: 0.0958416789
  計算されたport_ret: 0.0896678901
  weights側のport_ret: 0.0896678901
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08054626 -0.15992220   -0.01288113
1469.T 0.08054626 -0.14273201   -0.01149653
1569.T 0.08054626 -0.11695906   -0.00942061
9104.T 0.03158013  0.15106093    0.00477052
9101.T 0.02944978  0.13431718    0.00395561
9983.T 0.04340733  0.07814630    0.00339212
6758.T 0.02688296  0.09127165    0.00245365
6501.T 0.01467772  0.16617214    0.00243903
4578.T 0.04491360  0.05240120    0.00235353
8267.T 0.04148621  0.05130592    0.00212849

  [統計]
    合計寄与（port_ret再構築）: 0.0082152774
    eval側のport_ret: 0.0082152774
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 45

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01288113           -0.00000000        -0.01288113
1469.T        -0.01149653           -0.00193609        -0.00956044
1569.T        -0.00942061           -0.00000000        -0.00942061
6361.T                NaN            0.00426992        -0.00426992
6504.T                NaN            0.00397217        -0.00397217
6723.T                NaN            0.00301026        -0.00301026
9104.T         0.00477052            0.00182931         0.00294121
9983.T         0.00339212            0.00062542         0.00276671
9101.T         0.00395561            0.00131348         0.00264213
3086.T                NaN            0.00253522        -0.00253522

  合計寄与差分: -0.0814526127

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:close, na:zero, cause:1:date_alignment,4:price_diff | diff_original:0.08145261, diff_best:0.05760884, improvement:29.3%

[分析 3/3] 2025-04-10
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANA (window=60), 対象日=2025-04-10 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-07 ～ 2025-04-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-07       -0.01218512          -0.07745269 0.06526757      False -0.07614887
2025-04-08       -0.00133149           0.06801084 0.06934233      False  0.06022608
2025-04-09        0.00105353          -0.03780157 0.03885510      False -0.03373402
2025-04-10        0.00886563           0.08277952 0.07391389      False  0.08406901
2025-04-11       -0.01591198          -0.02598387 0.01007189      False -0.03127891
2025-04-14        0.00314253           0.00641107 0.00326855      False  0.00878870
2025-04-15        0.00573461           0.00951263 0.00377803      False  0.01041663

[STEP 3] 対象日 2025-04-10 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0088656328
  port_ret_cc_weights: 0.0827795217
  差分:                 -0.0739138888
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02922083  0.14184392    0.00414480
6504.T 0.02382695  0.11075654    0.00263899
1469.T 0.01592706 -0.15990449   -0.00254681
6723.T 0.01620551  0.15686275    0.00254204
6501.T 0.01718007  0.14426633    0.00247851
7259.T 0.02568458  0.09632852    0.00247416
6472.T 0.02550558  0.09291573    0.00236987
7012.T 0.01445130  0.15487065    0.00223808
6473.T 0.02463046  0.08933713    0.00220041
6752.T 0.01552928  0.13215704    0.00205230

  合計寄与（絶対値）: 0.0880156593
  計算されたport_ret: 0.0827795217
  weights側のport_ret: 0.0827795217
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08548409 -0.16177577   -0.01382925
1469.T 0.08548409 -0.15990449   -0.01366929
1569.T 0.07338692 -0.08048868   -0.00590682
9766.T 0.03083289  0.11055431    0.00340871
9433.T 0.05529582  0.05887302    0.00325543
8267.T 0.04594420  0.05221725    0.00239908
7974.T 0.01880943  0.11695897    0.00219993
9983.T 0.02332989  0.09056774    0.00211294
9020.T 0.04182056  0.05008459    0.00209457
9501.T 0.03154900  0.06197186    0.00195515

  [統計]
    合計寄与（port_ret再構築）: 0.0088656328
    eval側のport_ret: 0.0088656328
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 47

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01382925           -0.00000000        -0.01382925
1469.T        -0.01366929           -0.00254681        -0.01112248
1569.T        -0.00590682           -0.00000000        -0.00590682
6361.T                NaN            0.00414480        -0.00414480
9433.T         0.00325543            0.00051521         0.00274023
6504.T                NaN            0.00263899        -0.00263899
6723.T                NaN            0.00254204        -0.00254204
6501.T                NaN            0.00247851        -0.00247851
7259.T                NaN            0.00247416        -0.00247416
9766.T         0.00340871            0.00097363         0.00243508

  合計寄与差分: -0.0739138888

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:adj, na:zero, cause:1:date_alignment | diff_original:0.07391389, diff_best:0.01623358, improvement:78.0%

================================================================================
=== PLANA (window=120) の分析 ===
================================================================================

[分析 1/3] 2024-08-05
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANA (window=120), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01596633 0.01039939      False  0.01522577
2024-08-01       -0.02924373          -0.03594044 0.00669671      False -0.03258061
2024-08-02       -0.04968531          -0.05499560 0.00531029      False -0.06111902
2024-08-05       -0.03278594          -0.12355226 0.09076632      False -0.10817993
2024-08-06        0.00821528           0.03801115 0.02979587      False  0.06043839
2024-08-07       -0.00082378           0.01007675 0.01090053      False  0.03712618
2024-08-08       -0.00102468          -0.01119061 0.01016594      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1235522626
  差分:                 0.0907663188
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02363584 -0.20252830   -0.00478693
7014.T 0.01563962 -0.24676121   -0.00385925
6504.T 0.02460713 -0.14100972   -0.00346984
7270.T 0.01656729 -0.18338639   -0.00303822
9984.T 0.01618274 -0.18657853   -0.00301935
3086.T 0.01829974 -0.16414471   -0.00300381
6472.T 0.01877547 -0.15722574   -0.00295199
6305.T 0.02041674 -0.14291946   -0.00291795
8031.T 0.01354244 -0.19868423   -0.00269067
1469.T 0.01365345  0.19643793    0.00268205

  合計寄与（絶対値）: 0.1289163723
  計算されたport_ret: -0.1235522626
  weights側のport_ret: -0.1235522626
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T         0.01586777            0.00000000         0.01586777
1469.T         0.01690989            0.00268205         0.01422784
1569.T         0.00924064            0.00000000         0.00924064
9104.T        -0.00747640           -0.00177623        -0.00570017
8308.T        -0.00656938           -0.00104235        -0.00552704
6361.T                NaN           -0.00478693         0.00478693
7182.T        -0.00546670           -0.00126009        -0.00420661
9101.T        -0.00528487           -0.00127976        -0.00400511
7014.T                NaN           -0.00385925         0.00385925
6504.T                NaN           -0.00346984         0.00346984

  合計寄与差分: 0.0907663188

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.09076632, no_pattern_improves >10%

[分析 2/3] 2025-04-10
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANA (window=120), 対象日=2025-04-10 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-07 ～ 2025-04-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-07       -0.01218512          -0.07745269 0.06526757      False -0.07614887
2025-04-08       -0.00133149           0.06801084 0.06934233      False  0.06022608
2025-04-09        0.00105353          -0.03780157 0.03885510      False -0.03373402
2025-04-10        0.00886563           0.08277952 0.07391389      False  0.08406901
2025-04-11       -0.00529077          -0.02598387 0.02069311       True -0.03127891
2025-04-14        0.00064392           0.00641107 0.00576716       True  0.00878870
2025-04-15        0.00180958           0.00951263 0.00770305       True  0.01041663

[STEP 3] 対象日 2025-04-10 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0088656328
  port_ret_cc_weights: 0.0827795217
  差分:                 -0.0739138888
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02922083  0.14184392    0.00414480
6504.T 0.02382695  0.11075654    0.00263899
1469.T 0.01592706 -0.15990449   -0.00254681
6723.T 0.01620551  0.15686275    0.00254204
6501.T 0.01718007  0.14426633    0.00247851
7259.T 0.02568458  0.09632852    0.00247416
6472.T 0.02550558  0.09291573    0.00236987
7012.T 0.01445130  0.15487065    0.00223808
6473.T 0.02463046  0.08933713    0.00220041
6752.T 0.01552928  0.13215704    0.00205230

  合計寄与（絶対値）: 0.0880156593
  計算されたport_ret: 0.0827795217
  weights側のport_ret: 0.0827795217
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08548409 -0.16177577   -0.01382925
1469.T 0.08548409 -0.15990449   -0.01366929
1569.T 0.07338692 -0.08048868   -0.00590682
9766.T 0.03083289  0.11055431    0.00340871
9433.T 0.05529582  0.05887302    0.00325543
8267.T 0.04594420  0.05221725    0.00239908
7974.T 0.01880943  0.11695897    0.00219993
9983.T 0.02332989  0.09056774    0.00211294
9020.T 0.04182056  0.05008459    0.00209457
9501.T 0.03154900  0.06197186    0.00195515

  [統計]
    合計寄与（port_ret再構築）: 0.0088656328
    eval側のport_ret: 0.0088656328
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 47

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01382925           -0.00000000        -0.01382925
1469.T        -0.01366929           -0.00254681        -0.01112248
1569.T        -0.00590682           -0.00000000        -0.00590682
6361.T                NaN            0.00414480        -0.00414480
9433.T         0.00325543            0.00051521         0.00274023
6504.T                NaN            0.00263899        -0.00263899
6723.T                NaN            0.00254204        -0.00254204
6501.T                NaN            0.00247851        -0.00247851
7259.T                NaN            0.00247416        -0.00247416
9766.T         0.00340871            0.00097363         0.00243508

  合計寄与差分: -0.0739138888

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:adj, na:zero, cause:1:date_alignment | diff_original:0.07391389, diff_best:0.01623358, improvement:78.0%

[分析 3/3] 2025-04-08
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANA (window=120), 対象日=2025-04-08 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-03 ～ 2025-04-11

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-03       -0.00019797          -0.02767484 0.02747686      False -0.03053975
2025-04-04        0.01166369          -0.03376425 0.04542794       True -0.03553116
2025-04-07       -0.01218512          -0.07745269 0.06526757      False -0.07614887
2025-04-08       -0.00133149           0.06801084 0.06934233      False  0.06022608
2025-04-09        0.00105353          -0.03780157 0.03885510      False -0.03373402
2025-04-10        0.00886563           0.08277952 0.07391389      False  0.08406901
2025-04-11       -0.00529077          -0.02598387 0.02069311       True -0.03127891

[STEP 3] 対象日 2025-04-08 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0013314870
  port_ret_cc_weights: 0.0680108398
  差分:                 -0.0693423269
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight        ret  contribution
6504.T 0.03020962 0.13751813    0.00415437
6501.T 0.01705978 0.14052353    0.00239730
6098.T 0.01692057 0.12970775    0.00219473
8308.T 0.01571934 0.13285554    0.00208840
8766.T 0.01578298 0.12749890    0.00201231
8411.T 0.01481644 0.13504280    0.00200085
6762.T 0.01741776 0.11463623    0.00199671
6723.T 0.01609721 0.12318841    0.00198299
7259.T 0.02551609 0.07579635    0.00193403
7014.T 0.01583469 0.11838797    0.00187464

  合計寄与（絶対値）: 0.0713372787
  計算されたport_ret: 0.0680108398
  weights側のport_ret: 0.0680108398
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08234572 -0.13575930   -0.01117920
1469.T 0.08234572 -0.10391163   -0.00855668
1569.T 0.08234572 -0.06536857   -0.00538282
2914.T 0.04223795  0.04624580    0.00195333
9983.T 0.03247700  0.05186071    0.00168428
9501.T 0.01987485  0.08452947    0.00168001
9766.T 0.03479920  0.04633784    0.00161252
7974.T 0.02233089  0.07037192    0.00157147
9432.T 0.04170768  0.03455721    0.00144130
4689.T 0.02294500  0.05744459    0.00131807

  [統計]
    合計寄与（port_ret再構築）: -0.0013314870
    eval側のport_ret: -0.0013314870
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 46

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01117920           -0.00000000        -0.01117920
1469.T        -0.00855668           -0.00165574        -0.00690094
1569.T        -0.00538282           -0.00000000        -0.00538282
6504.T                NaN            0.00415437        -0.00415437
6501.T                NaN            0.00239730        -0.00239730
6098.T                NaN            0.00219473        -0.00219473
8308.T                NaN            0.00208840        -0.00208840
8766.T                NaN            0.00201231        -0.00201231
8411.T                NaN            0.00200085        -0.00200085
6762.T                NaN            0.00199671        -0.00199671

  合計寄与差分: -0.0693423269

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.06934233, no_pattern_improves >10%

================================================================================
=== PLANB (window=60) の分析 ===
================================================================================

[分析 1/3] 2024-08-05
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANB (window=60), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01471011 0.00914317      False  0.01522577
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.08358372 0.07536844      False  0.06043839
2024-08-07       -0.00082378           0.02217924 0.02300302      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1157225280
  差分:                 0.0829365841
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02300154 -0.20252830   -0.00465846
7014.T 0.01521991 -0.24676121   -0.00375568
6504.T 0.02394676 -0.14100972   -0.00337673
7270.T 0.01612269 -0.18338639   -0.00295668
9984.T 0.01574846 -0.18657853   -0.00293832
3086.T 0.01780864 -0.16414471   -0.00292319
6472.T 0.01827160 -0.15722574   -0.00287277
6305.T 0.01986883 -0.14291946   -0.00283964
8031.T 0.01317901 -0.19868423   -0.00261846
1469.T 0.01328704  0.19643793    0.00261008

  合計寄与（絶対値）: 0.1299707526
  計算されたport_ret: -0.1157225280
  weights側のport_ret: -0.1157225280
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1469.T         0.01690989            0.00261008         0.01429982
1356.T         0.01586777            0.00243784         0.01342992
1569.T         0.00924064            0.00207619         0.00716445
9104.T        -0.00747640           -0.00172856        -0.00574784
8308.T        -0.00656938           -0.00101437        -0.00555501
6361.T                NaN           -0.00465846         0.00465846
7182.T        -0.00546670           -0.00122628        -0.00424042
9101.T        -0.00528487           -0.00124541        -0.00403946
7014.T                NaN           -0.00375568         0.00375568
9983.T        -0.00421962           -0.00074949        -0.00347013

  合計寄与差分: 0.0829365841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.08293658, no_pattern_improves >10%

[分析 2/3] 2024-08-06
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANB (window=60), 対象日=2024-08-06 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-08-01 ～ 2024-08-09

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.08358372 0.07536844      False  0.06043839
2024-08-07       -0.00082378           0.02217924 0.02300302      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991
2024-08-09        0.00100726           0.00876930 0.00776204      False  0.01057160

[STEP 3] 対象日 2024-08-06 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0082152774
  port_ret_cc_weights: 0.0835837177
  差分:                 -0.0753684403
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02321759  0.17899608    0.00415586
6504.T 0.02413966  0.16015373    0.00386606
6723.T 0.01537037  0.19061664    0.00292985
3086.T 0.01801698  0.13695407    0.00246750
6861.T 0.01373843  0.17658129    0.00242595
4901.T 0.01443673  0.15984045    0.00230757
4689.T 0.02250772  0.09740255    0.00219231
7735.T 0.01722608  0.12499985    0.00215326
1356.T 0.01314043 -0.15992220   -0.00210145
6902.T 0.01510417  0.13773895    0.00208043

  合計寄与（絶対値）: 0.0969703410
  計算されたport_ret: 0.0835837177
  weights側のport_ret: 0.0835837177
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08054626 -0.15992220   -0.01288113
1469.T 0.08054626 -0.14273201   -0.01149653
1569.T 0.08054626 -0.11695906   -0.00942061
9104.T 0.03158013  0.15106093    0.00477052
9101.T 0.02944978  0.13431718    0.00395561
9983.T 0.04340733  0.07814630    0.00339212
6758.T 0.02688296  0.09127165    0.00245365
6501.T 0.01467772  0.16617214    0.00243903
4578.T 0.04491360  0.05240120    0.00235353
8267.T 0.04148621  0.05130592    0.00212849

  [統計]
    合計寄与（port_ret再構築）: 0.0082152774
    eval側のport_ret: 0.0082152774
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 45

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01288113           -0.00210145        -0.01077969
1469.T        -0.01149653           -0.00188437        -0.00961216
1569.T        -0.00942061           -0.00158743        -0.00783318
6361.T                NaN            0.00415586        -0.00415586
6504.T                NaN            0.00386606        -0.00386606
9104.T         0.00477052            0.00178044         0.00299008
6723.T                NaN            0.00292985        -0.00292985
9983.T         0.00339212            0.00060871         0.00278341
9101.T         0.00395561            0.00127840         0.00267721
3086.T                NaN            0.00246750        -0.00246750

  合計寄与差分: -0.0753684403

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:close, na:zero, cause:1:date_alignment,4:price_diff | diff_original:0.07536844, diff_best:0.05152467, improvement:31.6%

[分析 3/3] 2025-04-10
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANB (window=60), 対象日=2025-04-10 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-07 ～ 2025-04-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-07       -0.01218512          -0.06941691 0.05723179      False -0.07614887
2025-04-08       -0.00133149           0.06289805 0.06422954      False  0.06022608
2025-04-09        0.00105353          -0.03495721 0.03601074      False -0.03373402
2025-04-10        0.00886563           0.07658934 0.06772370      False  0.08406901
2025-04-11       -0.01591198          -0.02428118 0.00836920      False -0.03127891
2025-04-14        0.00314253           0.00590992 0.00276739      False  0.00878870
2025-04-15        0.00573461           0.00840334 0.00266873      False  0.01041663

[STEP 3] 対象日 2025-04-10 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0088656328
  port_ret_cc_weights: 0.0765893374
  差分:                 -0.0677237045
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02834105  0.14184392    0.00402001
6504.T 0.02310957  0.11075654    0.00255954
1356.T 0.01567901 -0.16177577   -0.00253648
1469.T 0.01544753 -0.15990449   -0.00247013
6723.T 0.01571759  0.15686275    0.00246550
6501.T 0.01666281  0.14426633    0.00240388
7259.T 0.02491127  0.09632852    0.00239967
6472.T 0.02473765  0.09291573    0.00229852
7012.T 0.01401620  0.15487065    0.00217070
6473.T 0.02388889  0.08933713    0.00213416

  合計寄与（絶対値）: 0.0890635380
  計算されたport_ret: 0.0765893374
  weights側のport_ret: 0.0765893374
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08548409 -0.16177577   -0.01382925
1469.T 0.08548409 -0.15990449   -0.01366929
1569.T 0.07338692 -0.08048868   -0.00590682
9766.T 0.03083289  0.11055431    0.00340871
9433.T 0.05529582  0.05887302    0.00325543
8267.T 0.04594420  0.05221725    0.00239908
7974.T 0.01880943  0.11695897    0.00219993
9983.T 0.02332989  0.09056774    0.00211294
9020.T 0.04182056  0.05008459    0.00209457
9501.T 0.03154900  0.06197186    0.00195515

  [統計]
    合計寄与（port_ret再構築）: 0.0088656328
    eval側のport_ret: 0.0088656328
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 47

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01382925           -0.00253648        -0.01129277
1469.T        -0.01366929           -0.00247013        -0.01119916
1569.T        -0.00590682           -0.00116137        -0.00474544
6361.T                NaN            0.00402001        -0.00402001
9433.T         0.00325543            0.00049969         0.00275574
6504.T                NaN            0.00255954        -0.00255954
6723.T                NaN            0.00246550        -0.00246550
9766.T         0.00340871            0.00094432         0.00246439
6501.T                NaN            0.00240388        -0.00240388
7259.T                NaN            0.00239967        -0.00239967

  合計寄与差分: -0.0677237045

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:adj, na:zero, cause:1:date_alignment | diff_original:0.06772370, diff_best:0.01004340, improvement:85.2%

================================================================================
=== PLANB (window=120) の分析 ===
================================================================================

[分析 1/3] 2024-08-05
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANB (window=120), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01471011 0.00914317      False  0.01522577
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.04179186 0.03357658      False  0.06043839
2024-08-07       -0.00082378           0.01108962 0.01191340      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1157225280
  差分:                 0.0829365841
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02300154 -0.20252830   -0.00465846
7014.T 0.01521991 -0.24676121   -0.00375568
6504.T 0.02394676 -0.14100972   -0.00337673
7270.T 0.01612269 -0.18338639   -0.00295668
9984.T 0.01574846 -0.18657853   -0.00293832
3086.T 0.01780864 -0.16414471   -0.00292319
6472.T 0.01827160 -0.15722574   -0.00287277
6305.T 0.01986883 -0.14291946   -0.00283964
8031.T 0.01317901 -0.19868423   -0.00261846
1469.T 0.01328704  0.19643793    0.00261008

  合計寄与（絶対値）: 0.1299707526
  計算されたport_ret: -0.1157225280
  weights側のport_ret: -0.1157225280
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1469.T         0.01690989            0.00261008         0.01429982
1356.T         0.01586777            0.00243784         0.01342992
1569.T         0.00924064            0.00207619         0.00716445
9104.T        -0.00747640           -0.00172856        -0.00574784
8308.T        -0.00656938           -0.00101437        -0.00555501
6361.T                NaN           -0.00465846         0.00465846
7182.T        -0.00546670           -0.00122628        -0.00424042
9101.T        -0.00528487           -0.00124541        -0.00403946
7014.T                NaN           -0.00375568         0.00375568
9983.T        -0.00421962           -0.00074949        -0.00347013

  合計寄与差分: 0.0829365841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.08293658, no_pattern_improves >10%

[分析 2/3] 2025-04-10
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANB (window=120), 対象日=2025-04-10 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-07 ～ 2025-04-15

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-07       -0.01218512          -0.06941691 0.05723179      False -0.07614887
2025-04-08       -0.00133149           0.06289805 0.06422954      False  0.06022608
2025-04-09        0.00105353          -0.03495721 0.03601074      False -0.03373402
2025-04-10        0.00886563           0.07658934 0.06772370      False  0.08406901
2025-04-11       -0.00795599          -0.02428118 0.01632519       True -0.03127891
2025-04-14        0.00157126           0.00590992 0.00433866       True  0.00878870
2025-04-15        0.00286730           0.00840334 0.00553603       True  0.01041663

[STEP 3] 対象日 2025-04-10 の詳細分析
================================================================================
  port_ret_cc_eval:    0.0088656328
  port_ret_cc_weights: 0.0765893374
  差分:                 -0.0677237045
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6361.T 0.02834105  0.14184392    0.00402001
6504.T 0.02310957  0.11075654    0.00255954
1356.T 0.01567901 -0.16177577   -0.00253648
1469.T 0.01544753 -0.15990449   -0.00247013
6723.T 0.01571759  0.15686275    0.00246550
6501.T 0.01666281  0.14426633    0.00240388
7259.T 0.02491127  0.09632852    0.00239967
6472.T 0.02473765  0.09291573    0.00229852
7012.T 0.01401620  0.15487065    0.00217070
6473.T 0.02388889  0.08933713    0.00213416

  合計寄与（絶対値）: 0.0890635380
  計算されたport_ret: 0.0765893374
  weights側のport_ret: 0.0765893374
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08548409 -0.16177577   -0.01382925
1469.T 0.08548409 -0.15990449   -0.01366929
1569.T 0.07338692 -0.08048868   -0.00590682
9766.T 0.03083289  0.11055431    0.00340871
9433.T 0.05529582  0.05887302    0.00325543
8267.T 0.04594420  0.05221725    0.00239908
7974.T 0.01880943  0.11695897    0.00219993
9983.T 0.02332989  0.09056774    0.00211294
9020.T 0.04182056  0.05008459    0.00209457
9501.T 0.03154900  0.06197186    0.00195515

  [統計]
    合計寄与（port_ret再構築）: 0.0088656328
    eval側のport_ret: 0.0088656328
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 47

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01382925           -0.00253648        -0.01129277
1469.T        -0.01366929           -0.00247013        -0.01119916
1569.T        -0.00590682           -0.00116137        -0.00474544
6361.T                NaN            0.00402001        -0.00402001
9433.T         0.00325543            0.00049969         0.00275574
6504.T                NaN            0.00255954        -0.00255954
6723.T                NaN            0.00246550        -0.00246550
9766.T         0.00340871            0.00094432         0.00246439
6501.T                NaN            0.00240388        -0.00240388
7259.T                NaN            0.00239967        -0.00239967

  合計寄与差分: -0.0677237045

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: weights:nolag, price:adj, na:zero, cause:1:date_alignment | diff_original:0.06772370, diff_best:0.01004340, improvement:85.2%

[分析 3/3] 2025-04-08
--------------------------------------------------------------------------------
================================================================================
=== 差分分析: PLANB (window=120), 対象日=2025-04-08 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2025-04-03 ～ 2025-04-11

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2025-04-03       -0.00019797          -0.02458281 0.02438484      False -0.03053975
2025-04-04        0.00195507          -0.03017803 0.03213310       True -0.03553116
2025-04-07       -0.01218512          -0.06941691 0.05723179      False -0.07614887
2025-04-08       -0.00133149           0.06289805 0.06422954      False  0.06022608
2025-04-09        0.00105353          -0.03495721 0.03601074      False -0.03373402
2025-04-10        0.00886563           0.07658934 0.06772370      False  0.08406901
2025-04-11       -0.00795599          -0.02428118 0.01632519       True -0.03127891

[STEP 3] 対象日 2025-04-08 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0013314870
  port_ret_cc_weights: 0.0628980532
  差分:                 -0.0642295403
  STOPフラグ:          False

[weights側] Top寄与銘柄（w[t-1] * r[t]）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
symbol     weight         ret  contribution
6504.T 0.02930170  0.13751813    0.00402951
6501.T 0.01654707  0.14052353    0.00232525
1356.T 0.01568673 -0.13575930   -0.00212962
6098.T 0.01641204  0.12970775    0.00212877
8308.T 0.01524691  0.13285554    0.00202564
8766.T 0.01530864  0.12749890    0.00195183
8411.T 0.01437114  0.13504280    0.00194072
6762.T 0.01689429  0.11463623    0.00193670
6723.T 0.01561343  0.12318841    0.00192339
7259.T 0.02474923  0.07579635    0.00187590

  合計寄与（絶対値）: 0.0722620952
  計算されたport_ret: 0.0628980532
  weights側のport_ret: 0.0628980532
  差分: 0.0000000000

[eval側] ポートフォリオリターンの内訳
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  [設定] w[t-1], adj_close, na_fill=zero
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1356.T 0.08234572 -0.13575930   -0.01117920
1469.T 0.08234572 -0.10391163   -0.00855668
1569.T 0.08234572 -0.06536857   -0.00538282
2914.T 0.04223795  0.04624580    0.00195333
9983.T 0.03247700  0.05186071    0.00168428
9501.T 0.01987485  0.08452947    0.00168001
9766.T 0.03479920  0.04633784    0.00161252
7974.T 0.02233089  0.07037192    0.00157147
9432.T 0.04170768  0.03455721    0.00144130
4689.T 0.02294500  0.05744459    0.00131807

  [統計]
    合計寄与（port_ret再構築）: -0.0013314870
    eval側のport_ret: -0.0013314870
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    ret欠損数: 0
    weight欠損数: 0
    intersection銘柄数: 46

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  Top10寄与差分（eval - weights, 絶対値順）:
symbol  contribution_eval  contribution_weights  contribution_diff
1356.T        -0.01117920           -0.00212962        -0.00904958
1469.T        -0.00855668           -0.00160598        -0.00695070
1569.T        -0.00538282           -0.00093917        -0.00444365
6504.T                NaN            0.00402951        -0.00402951
6501.T                NaN            0.00232525        -0.00232525
6098.T                NaN            0.00212877        -0.00212877
8308.T                NaN            0.00202564        -0.00202564
8766.T                NaN            0.00195183        -0.00195183
8411.T                NaN            0.00194072        -0.00194072
6762.T                NaN            0.00193670        -0.00193670

  合計寄与差分: -0.0642295403

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high     low   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  4840.0  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  4830.0  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  4765.0  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  4905.0  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  4850.0  4890.0     4890.0   62940  3.077766e+08
  原因ラベル: unknown_multifactorial | diff:0.06422954, no_pattern_improves >10%
