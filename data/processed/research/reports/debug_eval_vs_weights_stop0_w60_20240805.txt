================================================================================
=== 差分分析: STOP0 (window=60), 対象日=2024-08-05 ===
================================================================================

[STEP 1] データを読み込み中...
  eval側: 2421 日分
  weights側: 2444 日分
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]
[INFO] Rebuilt cross4 returns from daily_portfolio_guarded + prices: 2421 days

[STEP 2] 対象日±3日を分析中...
  日付範囲: 2024-07-31 ～ 2024-08-08

[結果] 対象日±3日の比較
================================================================================
trade_date  port_ret_cc_eval  port_ret_cc_weights   abs_diff  stop_flag     tpx_ret
2024-07-31        0.00556694           0.01471011 0.00914317      False  0.01522577
2024-08-01       -0.02924373          -0.03398534 0.00474161      False -0.03258061
2024-08-02       -0.04968531          -0.05104025 0.00135494      False -0.06111902
2024-08-05       -0.03278594          -0.11572253 0.08293658      False -0.10817993
2024-08-06        0.00821528           0.08358372 0.07536844      False  0.06043839
2024-08-07       -0.00082378           0.02217924 0.02300302      False  0.03712618
2024-08-08       -0.00102468          -0.01018782 0.00916314      False -0.01160991

[STEP 3] 対象日 2024-08-05 の詳細分析
================================================================================
  port_ret_cc_eval:    -0.0327859438
  port_ret_cc_weights: -0.1157225280
  差分:                 0.0829365841
  STOPフラグ:          False

[eval側] ポートフォリオリターンの内訳（rebuild_port_ret_from_weights()から取得）
--------------------------------------------------------------------------------
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]
  [設定] w[t-1], adj_close (rebuild_port_ret_from_weights()使用)
  Top10寄与銘柄（w[t-1] * r[t], adj_close）:
symbol     weight         ret  contribution
1469.T 0.08608263  0.19643793    0.01690989
1356.T 0.08608263  0.18433180    0.01586777
1569.T 0.06057994  0.15253636    0.00924064
9104.T 0.05106153 -0.14641941   -0.00747640
8308.T 0.03373071 -0.19475975   -0.00656938
7182.T 0.03283280 -0.16650111   -0.00546670
9101.T 0.04061750 -0.13011310   -0.00528487
9983.T 0.04398436 -0.09593451   -0.00421962
6762.T 0.02500691 -0.16075451   -0.00401997
7974.T 0.02427648 -0.16525584   -0.00401183

  [統計]
    合計寄与（port_ret再構築）: -0.0327859438
    eval側のport_ret: -0.0327859438
    差分: 0.0000000000
    weights合計: 1.000000
    weights合計（ロング）: 1.000000
    weights合計（ショート）: 0.000000
    銘柄数: 49

[STEP 4] 寄与比較（weights側 vs eval側）
================================================================================
load_prices() columns: ['date', 'symbol', 'open', 'high', 'low', 'close', 'adj_close', 'volume', 'turnover']
symbols: ['1356.T' '1469.T' '1569.T' '2413.T' '2914.T' '3064.T' '3086.T' '3092.T'
 '3099.T' '3289.T'] … (n= 97 )
        date  symbol    open    high  ...   close  adj_close  volume      turnover
0 2015-12-21  1356.T  4895.0  5010.0  ...  4865.0     4865.0  275820  1.341864e+09
1 2015-12-22  1356.T  4855.0  4910.0  ...  4845.0     4845.0   61780  2.993241e+08
2 2015-12-24  1356.T  4775.0  4930.0  ...  4920.0     4920.0   89920  4.424064e+08
3 2015-12-25  1356.T  4915.0  4990.0  ...  4980.0     4980.0   96550  4.808190e+08
4 2015-12-28  1356.T  4925.0  4945.0  ...  4890.0     4890.0   62940  3.077766e+08

[5 rows x 9 columns]
  Δport_ret: -0.0327859438 - -0.1157225280 = 0.0829365841

  Top10 |Δcontrib|（寄与差分の絶対値順）:
symbol  contrib_eval  contrib_weights  contrib_diff
1469.T    0.01690989       0.00261008    0.01429982
1356.T    0.01586777       0.00243784    0.01342992
1569.T    0.00924064       0.00207619    0.00716445
9104.T   -0.00747640      -0.00172856   -0.00574784
8308.T   -0.00656938      -0.00101437   -0.00555501
6361.T           NaN      -0.00465846    0.00465846
7182.T   -0.00546670      -0.00122628   -0.00424042
9101.T   -0.00528487      -0.00124541   -0.00403946
7014.T           NaN      -0.00375568    0.00375568
9983.T   -0.00421962      -0.00074949   -0.00347013

  Top3銘柄の詳細比較:

    [1469.T]
      w_used_eval:    0.08608263
      w_used_weights: 0.01328704
      ret_eval:       0.19643793
      ret_weights:    0.19643793
      contrib_eval:   0.01690989
      contrib_weights: 0.00261008
      contrib_diff:   0.01429982
      w_diff:         0.07279560
      ret_diff:       0.00000000

    [1356.T]
      w_used_eval:    0.08608263
      w_used_weights: 0.01322531
      ret_eval:       0.18433180
      ret_weights:    0.18433180
      contrib_eval:   0.01586777
      contrib_weights: 0.00243784
      contrib_diff:   0.01342992
      w_diff:         0.07285733
      ret_diff:       0.00000000

    [1569.T]
      w_used_eval:    0.06057994
      w_used_weights: 0.01361111
      ret_eval:       0.15253636
      ret_weights:    0.15253636
      contrib_eval:   0.00924064
      contrib_weights: 0.00207619
      contrib_diff:   0.00716445
      w_diff:         0.04696883
      ret_diff:       0.00000000

  合計寄与差分: 0.0829365841

[STEP 5] 差分原因の分類（原因ラベル特定）
================================================================================
  原因ラベル: cause:1:date_alignment | diff:0.08293658 | top10_w_diff_mean:0.044136, top10_ret_diff_mean:0.000000
