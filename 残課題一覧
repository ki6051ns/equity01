# equity01 残課題一覧 & 対応状況  
**Updated: 2025/12/04（10th_commit 反映）**

本一覧は 8th → 9th → 10th_commit の成果と、  
**ラダー方式ホライゾンバックテスト（H1〜H120）** の採用方針を踏まえた最新版です。

---

# 1. データ基盤（Raw / Processed）

| 項目 | 内容 | 状況 |
|------|------|------|
| 94銘柄 parquet 化 | 日次価格パネル基盤 | ✔ 完了 |
| ユニバーススナップショット | 月次/四半期で universe 保存 | ⏳ 未実装 |
| 東証休日カレンダー | 祝日/臨時休場/米国休場含む | 🔜 event01 前に必須 |
| NY 祝日対応 | FX/VIX/先物の欠損吸収 | ⏳ |
| Cutoff Policy（D-1 08:00） | 全スクリプトで統一 | ✔ |

---

# 2. Feature Builder（特徴量）

| 項目 | 内容 | 状況 |
|------|------|------|
| 基本 ret/vol/ADV | ret_5, ret_20, vol_20, ADV | ✔ |
| heat_flag（過熱抑制） | zscore ベース | ✔ |
| volume acceleration | 成行インパクト低減に重要 | ⏳ |
| multi-horizon feature | H60/H90/H120 の安定化支援 | ⏳ 検討中 |
| Quick-FA | EPS, ROIC | ❌ scope外 |
| strength | ノイズ源のため廃止 | ✔ |

---

# 3. Scoring Engine

| 項目 | 内容 | 状況 |
|------|------|------|
| Z-score 正規化 | size bucket 内標準化 | ✔ |
| 特性ペナルティ | 過熱/vol/liquidity | ✔ |
| size bucket | Large/Mid/Small の均等化 | ✔ |
| weighting scheme | score / zscore / equal | ✔ |
| パラメータアンサンブル | zscore × score (λ) | ⏳ 次フェーズ |
| score保存 | daily_feature_scores.parquet | ✔ |

---

# 4. Portfolio Builder（PF生成）

| 項目 | 内容 | 状況 |
|------|------|------|
| max_names = 30 | 最適解として安定 | ✔ |
| weight 正規化 | sum=1.0 / zscore重み | ✔ |
| decision ↔ trading date | cutoff理論に基づく | ✔ |
| β制御（ETF階段） | β 0.6 / 0.4 / 0.2 | ⏳ 中期 |
| レバレッジ管理（VAR） | VAR ≤ 2% | ❌ 未着手 |
| 実務クリーニング層 | 極小weightカット（min_abs） | ✔ |

---

# 5. EventGuard（イベント反射）

| バージョン | 内容 | 状況 |
|------------|------|------|
| v1.1 | FOMC/SQ/CPI/BOJ → must-kill | ✔ |
| v1.1 | 決算除外（日付ベース） | ✔ |
| v1.1 | 前日引けヘッジ → 当日解消 | ✔ |
| v0.3 | 225先物・USDJPY・VIX の閾値 | ⏳ 2026Q1 |
| v0.4 | BOJ/FOMC LLMスコアリング | ❌ |
| v1.0 | event01 + event02 完全統合 | 🔜 |

---

# 6. Horizon Ensemble（10th_commit の主成果）

| 項目 | 内容 | 状況 |
|------|------|------|
| H1〜H120 ラダーBT | 完全実装 | ✔ |
| 非ラダー→ラダー移行 | H1/H5/H10/H20 の精度改善 | ✔ |
| H60/H90/H120 採用 | コアホライゾンに確定 | ✔ |
| H5/H10 は補助採用 | 非ラダー weak signal | ✔ |
| H1/H20 は縮小 | ノイズ要因 | ✔ |
| Ensemble 設計 | equal weight / var weight | ⏳ 次フェーズ |
| Ensemble Runner | run_equity01_eval.py に統合 | ✔ |

---

# 7. Regime 判定

| 項目 | 内容 | 状況 |
|------|------|------|
| equity01 内部レジーム | 使用価値低 → 廃止 | ✔ |
| breadth PCA | 市場回復/拡散の強度分析 | ⏳ |
| Sticky-HMM | regime 2〜3 state | ❌ |
| ALPHAERS 共通レジーム | multipliers 適用 | 🔜 |

---

# 8. Intraweek Overlay（週内ロジック）

| 項目 | 内容 | 状況 |
|------|------|------|
| 月〜木 通常稼働 | 現状のベース | ✔ |
| 木→金 の縮小 | macro event 対応 | ⏳ |
| 金→月 WE跨ぎ縮小 | 最大リスク | ⏳ |
| 週内β階段 | β0.5 → β0.35 → β0.20 | ❌ 未実装 |

---

# 9. Paper Trade & QA

| 項目 | 内容 | 状況 |
|------|------|------|
| Returnベースに統一 | PnL混在を廃止 | ✔ |
| relative α 可視化 | calc_alpha_beta v2 | ✔ |
| H60/H90/H120 毎の統計 | 生成済 | ✔ |
| 銘柄寄与度分析 | contribution decomposition | ⏳ |
| 勝因/敗因の LLM 生成 | ALPHAERS共通仕組みへ | ⏳ |
| 回帰（β推計） | horizon別 β | ⏳ |

---

# 10. 外部接続（β・指数・先物）

| 項目 | 内容 | 状況 |
|------|------|------|
| index loader（TOPIX/225） | relative α用途 | ✔ |
| ETF loader（1306/1570） | β制御 | ⏳ |
| 225先物5分足 | Guard v0.3 | ⏳ |
| USDJPY/VIX | Guard v0.3 | ⏳ |
| グローバル株式連動 | equity02/03への流用 | 🔜 |

---

# 11. コード品質・高速化

| 項目 | 内容 | 状況 |
|------|------|------|
| print → logger | ログ階層化 | ⏳ |
| vectorize | 新規 horizon BT で要改善 | 🔜 |
| parquet schema 統一 | 互換性の徹底 | ✔ |
| スコア世代管理 | scores_YYYYMMDD | ✔ |
| outlier処理 | price jump, zero vol | ⏳ |

---

# 🔥 優先度（A / B / C）

## **A：最優先（現在着手すべき）**
- Ensemble（H60/H90/H120）v0.1  
- EventGuard v0.3（FX・先物・VIX）  
- Intraweek Overlay（木→金、金→月）  
- β制御（ETF階段）  
- NY祝日対応・cutoff完全対応  

---

## **B：次優先（品質・安定性）**
- パラメータアンサンブル（zscore × score）  
- 勝因/敗因説明（LLM）  
- ユニバーススナップショット（月次）  
- breadth PCA（regime基盤）  

---

## **C：中期（2026Q1〜）**
- Sticky-HMM による regime 2–3 state  
- VARベースのレバレッジ管理  
- multi-horizon weight optimization  
- outlier処理の自動化  

---

# 🎯 現状の総括（10th_commit 時点）

equity01 は以下の重要マイルストーンを達成：

- **守り：EventGuard v1.1**  
- **測定：relative α の確立**  
- **安定化：ラダー方式ホライゾン（H60/H90/H120）**  
- **透明性：全工程が可視化・再現可能**

残る課題は

> **アンサンブル・β制御・週内ロジック・ガード強化**

という “実運用向け洗練フェーズ” に集中している。

---

Prepared by **equity01 / Strategy Core Layer（2025/12/04）**
